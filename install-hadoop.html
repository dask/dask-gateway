 
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Install on a Hadoop Cluster &#8212; Dask Gateway 2024.1.0 documentation</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/css/style.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx-book-theme.9d8b4a8b9bb19db25eeaddc40d639ba2.js"></script>
    <link rel="shortcut icon" href="_static/images/favicon.svg"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Install on a Kubernetes Cluster" href="install-kube.html" />
    <link rel="prev" title="Install Locally (Quickstart)" href="install-local.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
<!-- Google Tag Manager (noscript) -->
<noscript
  ><iframe
    src="https://www.googletagmanager.com/ns.html?id=GTM-P4GQM59"
    height="0"
    width="0"
    style="display: none; visibility: hidden"
  ></iframe
></noscript>
<!-- End Google Tag Manager (noscript) -->
<nav class="dask-nav container-fluid">
  <ul>
    <li class="logo">
      <a href="https://docs.dask.org/">
        <img
          class="caption"
          src="_static/images/dask-horizontal-white.svg"
        />
      </a>
    </li>

    <li>
      <a href="https://docs.dask.org/">Dask</a>
    </li>

    <li>
      <a href="https://distributed.dask.org/">Distributed</a>
    </li>

    <li>
      <a href="https://ml.dask.org/">Dask ML</a>
    </li>

    <li>
      <a href="https://examples.dask.org/">Examples</a>
    </li>

    <li>
      <a href="https://docs.dask.org/en/latest/ecosystem.html">Ecosystem</a>
    </li>

    <li>
      <a href="https://docs.dask.org/en/latest/support.html">Community</a>
    </li>
  </ul>
</nav>


    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<div class="col-12 col-md-3 bd-sidebar site-navigation " id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Dask Gateway 2024.1.0 documentation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  For Users
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="install-user.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="usage.html">
   Usage
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="configuration-user.html">
   Configuration
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Admin - Installation
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="install-local.html">
   Install Locally (Quickstart)
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Install on a Hadoop Cluster
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="install-kube.html">
   Install on a Kubernetes Cluster
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="install-jobqueue.html">
   Install on an HPC Job Queue
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Admin - Customization
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="authentication.html">
   Authentication
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="security.html">
   Security settings
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cluster-options.html">
   Exposing Cluster Options
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="resource-limits.html">
   Cluster Resource Limits
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Reference
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="api-client.html">
   Client API
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="api-server.html">
   Configuration Reference
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="develop.html">
   Development
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="changelog.html">
   Changelog
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<!-- This is an invisible pixel that we watch to see if we've scrolled. -->
<div class="sbt-scroll-pixel-helper"></div>
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            <div class="topbar-left">
                
                <label class="nav-toggle-button" for="__navigation">
                    <div class="visually-hidden">Toggle navigation</div>
                    <i class="fas fa-bars"></i>
                </label>
                
            </div>
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/install-hadoop.rst.txt"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.rst</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-a-user-account">
   Create a user account
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#enable-proxy-user-permissions">
   Enable proxy-user permissions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-install-directories">
   Create install directories
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#install-a-python-environment">
   Install a python environment
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#install-dask-gateway-server">
   Install dask-gateway-server
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#configure-dask-gateway-server">
   Configure dask-gateway-server
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#enable-yarn-integration">
     Enable YARN integration
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#enable-kerberos-security-optional">
     Enable kerberos security (optional)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#configure-the-server-addresses-optional">
     Configure the server addresses (optional)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#specify-user-python-environments">
     Specify user python environments
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#using-a-local-environment">
       Using a local environment
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#using-an-archived-environment">
       Using an archived environment
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#additional-configuration-options">
     Additional configuration options
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example">
     Example
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#open-relevant-port-s">
   Open relevant port(s)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#start-dask-gateway-server">
   Start dask-gateway-server
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#validate-things-are-working">
   Validate things are working
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Install on a Hadoop Cluster</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-a-user-account">
   Create a user account
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#enable-proxy-user-permissions">
   Enable proxy-user permissions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-install-directories">
   Create install directories
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#install-a-python-environment">
   Install a python environment
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#install-dask-gateway-server">
   Install dask-gateway-server
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#configure-dask-gateway-server">
   Configure dask-gateway-server
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#enable-yarn-integration">
     Enable YARN integration
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#enable-kerberos-security-optional">
     Enable kerberos security (optional)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#configure-the-server-addresses-optional">
     Configure the server addresses (optional)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#specify-user-python-environments">
     Specify user python environments
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#using-a-local-environment">
       Using a local environment
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#using-an-archived-environment">
       Using an archived environment
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#additional-configuration-options">
     Additional configuration options
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example">
     Example
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#open-relevant-port-s">
   Open relevant port(s)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#start-dask-gateway-server">
   Start dask-gateway-server
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#validate-things-are-working">
   Validate things are working
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="section" id="install-on-a-hadoop-cluster">
<h1>Install on a Hadoop Cluster<a class="headerlink" href="#install-on-a-hadoop-cluster" title="Permalink to this headline">¶</a></h1>
<p>Here we provide instructions for installing and configuring
<code class="docutils literal notranslate"><span class="pre">dask-gateway-server</span></code> on a <a class="reference external" href="https://hadoop.apache.org/">Hadoop Cluster</a>.</p>
<div class="section" id="create-a-user-account">
<h2>Create a user account<a class="headerlink" href="#create-a-user-account" title="Permalink to this headline">¶</a></h2>
<p>Before installing anything, you’ll need to create the user account which will
be used to run the <code class="docutils literal notranslate"><span class="pre">dask-gateway-server</span></code> process. The name of the user
doesn’t matter, only the permissions they have. Here we’ll use <code class="docutils literal notranslate"><span class="pre">dask</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>adduser<span class="w"> </span>dask
</pre></div>
</div>
</div>
<div class="section" id="enable-proxy-user-permissions">
<h2>Enable proxy-user permissions<a class="headerlink" href="#enable-proxy-user-permissions" title="Permalink to this headline">¶</a></h2>
<p>Dask-Gateway makes full use of Hadoop’s security model, and will start Dask
workers in containers with the requesting user’s permissions (e.g. if <code class="docutils literal notranslate"><span class="pre">alice</span></code>
creates a cluster, their dask workers will be running as user <code class="docutils literal notranslate"><span class="pre">alice</span></code>).  To
accomplish this, the gateway server needs <a class="reference external" href="https://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-common/Superusers.html">proxy-user</a> permissions. This
allows the Dask-Gateway server to perform actions impersonating another user.</p>
<p>For <code class="docutils literal notranslate"><span class="pre">dask-gateway-server</span></code> to work properly, you’ll need to enable
<a class="reference external" href="https://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-common/Superusers.html">proxy-user</a> permissions for the <code class="docutils literal notranslate"><span class="pre">dask</span></code> user account. The users <code class="docutils literal notranslate"><span class="pre">dask</span></code> has
permission to impersonate can be restricted to certain groups, and requests to
impersonate may be restricted to certain hosts. At a minimum, the <code class="docutils literal notranslate"><span class="pre">dask</span></code> user
will require permission to impersonate anyone using the gateway, with requests
allowed from at least the host running the <code class="docutils literal notranslate"><span class="pre">dask-gateway-server</span></code>.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;property&gt;</span>
<span class="w">  </span><span class="nt">&lt;name&gt;</span>hadoop.proxyuser.dask.hosts<span class="nt">&lt;/name&gt;</span>
<span class="w">  </span><span class="nt">&lt;value&gt;</span>host-where-dask-gateway-is-running<span class="nt">&lt;/value&gt;</span>
<span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;property&gt;</span>
<span class="w">  </span><span class="nt">&lt;name&gt;</span>hadoop.proxyuser.dask.groups<span class="nt">&lt;/name&gt;</span>
<span class="w">  </span><span class="nt">&lt;value&gt;</span>group1,group2<span class="nt">&lt;/value&gt;</span>
<span class="nt">&lt;/property&gt;</span>
</pre></div>
</div>
<p>If looser restrictions are acceptable, you may also use the wildcard <code class="docutils literal notranslate"><span class="pre">*</span></code>
to allow impersonation of any user or from any host.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;property&gt;</span>
<span class="w">  </span><span class="nt">&lt;name&gt;</span>hadoop.proxyuser.dask.hosts<span class="nt">&lt;/name&gt;</span>
<span class="w">  </span><span class="nt">&lt;value&gt;</span>*<span class="nt">&lt;/value&gt;</span>
<span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;property&gt;</span>
<span class="w">  </span><span class="nt">&lt;name&gt;</span>hadoop.proxyuser.dask.groups<span class="nt">&lt;/name&gt;</span>
<span class="w">  </span><span class="nt">&lt;value&gt;</span>*<span class="nt">&lt;/value&gt;</span>
<span class="nt">&lt;/property&gt;</span>
</pre></div>
</div>
<p>See the <a class="reference external" href="https://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-common/Superusers.html">proxy-user</a> documentation for more information.</p>
</div>
<div class="section" id="create-install-directories">
<h2>Create install directories<a class="headerlink" href="#create-install-directories" title="Permalink to this headline">¶</a></h2>
<p>A <code class="docutils literal notranslate"><span class="pre">dask-gateway-server</span></code> installation has three types of files which will need
their own directories created before installation:</p>
<ul class="simple">
<li><p>Software files: This includes a Python environment and all required
libraries. Here we use <code class="docutils literal notranslate"><span class="pre">/opt/dask-gateway</span></code>.</p></li>
<li><p>Configuration files: Here we use <code class="docutils literal notranslate"><span class="pre">/etc/dask-gateway</span></code>.</p></li>
<li><p>Runtime files: Here we use <code class="docutils literal notranslate"><span class="pre">/var/dask-gateway</span></code>.</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Software files</span>
$<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/opt/dask-gateway

<span class="c1"># Configuration files</span>
$<span class="w"> </span>mkdir<span class="w"> </span>/etc/dask-gateway

<span class="c1"># Runtime files</span>
$<span class="w"> </span>mkdir<span class="w"> </span>/var/dask-gateway
$<span class="w"> </span>chown<span class="w"> </span>dask<span class="w"> </span>/var/dask-gateway
</pre></div>
</div>
</div>
<div class="section" id="install-a-python-environment">
<h2>Install a python environment<a class="headerlink" href="#install-a-python-environment" title="Permalink to this headline">¶</a></h2>
<p>To avoid interactions between the system python installation and
<code class="docutils literal notranslate"><span class="pre">dask-gateway-server</span></code>, we’ll install a full Python environment into the
software directory. The easiest way to do this is to use <a class="reference external" href="https://docs.conda.io/en/latest/miniconda.html">miniconda</a>, but this
isn’t a strict requirement.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>curl<span class="w"> </span>https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh<span class="w"> </span>-o<span class="w"> </span>/tmp/miniconda.sh
$<span class="w"> </span>bash<span class="w"> </span>/tmp/miniconda.sh<span class="w"> </span>-b<span class="w"> </span>-p<span class="w"> </span>/opt/dask-gateway/miniconda
$<span class="w"> </span>rm<span class="w"> </span>/tmp/miniconda.sh
</pre></div>
</div>
<p>We also recommend adding miniconda to the <code class="docutils literal notranslate"><span class="pre">root</span></code> user’s path to ease further
commands.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;export PATH=&quot;/opt/dask-gateway/miniconda/bin:$PATH&quot;&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/root/.bashrc
$<span class="w"> </span><span class="nb">source</span><span class="w"> </span>/root/.bashrc
</pre></div>
</div>
</div>
<div class="section" id="install-dask-gateway-server">
<h2>Install dask-gateway-server<a class="headerlink" href="#install-dask-gateway-server" title="Permalink to this headline">¶</a></h2>
<p>Now we can install <code class="docutils literal notranslate"><span class="pre">dask-gateway-server</span></code> and its dependencies.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conda<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>-c<span class="w"> </span>conda-forge<span class="w"> </span>dask-gateway-server-yarn
</pre></div>
</div>
<p>If you want to use Kerberos for user-facing authentication, you’ll also want to
install <code class="docutils literal notranslate"><span class="pre">dask-gateway-server-kerberos</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conda<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>-c<span class="w"> </span>conda-forge<span class="w"> </span>dask-gateway-server-kerberos
</pre></div>
</div>
</div>
<div class="section" id="configure-dask-gateway-server">
<h2>Configure dask-gateway-server<a class="headerlink" href="#configure-dask-gateway-server" title="Permalink to this headline">¶</a></h2>
<p>Now we’re ready to configure our <code class="docutils literal notranslate"><span class="pre">dask-gateway-server</span></code> installation.
Configuration is written as a Python file (typically
<code class="docutils literal notranslate"><span class="pre">/etc/dask-gateway/dask_gateway_config.py</span></code>). Options are assigned to a config
object <code class="docutils literal notranslate"><span class="pre">c</span></code>, which is then loaded by the gateway on startup. You are free to
use any python syntax/libraries in this file that you want, the only things
that matter to <code class="docutils literal notranslate"><span class="pre">dask-gateway-server</span></code> are the values set on the <code class="docutils literal notranslate"><span class="pre">c</span></code> config
object.</p>
<p>Here we’ll walk through a few common configuration options you may want to set.</p>
<div class="section" id="enable-yarn-integration">
<h3>Enable YARN integration<a class="headerlink" href="#enable-yarn-integration" title="Permalink to this headline">¶</a></h3>
<p>First you’ll want to enable YARN as the cluster backend.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Configure the gateway to use YARN as the backend</span>
<span class="n">c</span><span class="o">.</span><span class="n">DaskGateway</span><span class="o">.</span><span class="n">backend_class</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;dask_gateway_server.backends.yarn.YarnBackend&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="enable-kerberos-security-optional">
<h3>Enable kerberos security (optional)<a class="headerlink" href="#enable-kerberos-security-optional" title="Permalink to this headline">¶</a></h3>
<p>If your cluster has <a class="reference external" href="https://web.mit.edu/kerberos/">Kerberos</a> enabled, you’ll also need to create a principal
and keytab for the <code class="docutils literal notranslate"><span class="pre">dask</span></code> user. You’ll also need to create a <code class="docutils literal notranslate"><span class="pre">HTTP</span></code> service
principal for the host running <code class="docutils literal notranslate"><span class="pre">dask-gateway-server</span></code> (if one doesn’t already
exist).  Keytabs can be created on the command-line as:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the dask principal</span>
$<span class="w"> </span>kadmin<span class="w"> </span>-q<span class="w"> </span><span class="s2">&quot;addprinc -randkey dask@YOUR_REALM.COM&quot;</span>

<span class="c1"># Create the HTTP principal (if not already created)</span>
$<span class="w"> </span>kadmin<span class="w"> </span>-q<span class="w"> </span><span class="s2">&quot;addprinc -randkey HTTP/FQDN&quot;</span>

<span class="c1"># Create a keytab</span>
$<span class="w"> </span>kadmin<span class="w"> </span>-q<span class="w"> </span><span class="s2">&quot;xst -norandkey -k /etc/dask-gateway/dask.keytab dask HTTP/FQDN&quot;</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">FQDN</span></code> is the <a class="reference external" href="https://en.wikipedia.org/wiki/Fully_qualified_domain_name">fully qualified domain name</a> of the host running
<code class="docutils literal notranslate"><span class="pre">dask-gateway-server</span></code>.</p>
<p>Store the keytab file wherever you see fit (we recommend storing it along with
the other configuration in <code class="docutils literal notranslate"><span class="pre">/etc/dask-gateway/</span></code>, as above). You’ll also want
to make sure that <code class="docutils literal notranslate"><span class="pre">dask.keytab</span></code> is only readable by the <code class="docutils literal notranslate"><span class="pre">dask</span></code> user.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>chown<span class="w"> </span>dask<span class="w"> </span>/etc/dask-gateway/dask.keytab
$<span class="w"> </span>chmod<span class="w"> </span><span class="m">400</span><span class="w"> </span>/etc/dask-gateway/dask.keytab
</pre></div>
</div>
<p>To configure <code class="docutils literal notranslate"><span class="pre">dask-gateway-server</span></code> to use this keytab file, you’ll need to
add the following line to your <code class="docutils literal notranslate"><span class="pre">dask_gateway_config.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Specify the location of the keytab file, and the principal name</span>
<span class="n">c</span><span class="o">.</span><span class="n">YarnBackend</span><span class="o">.</span><span class="n">keytab</span> <span class="o">=</span> <span class="s2">&quot;/etc/dask-gateway/dask.keytab&quot;</span>
<span class="n">c</span><span class="o">.</span><span class="n">YarnBackend</span><span class="o">.</span><span class="n">principal</span> <span class="o">=</span> <span class="s2">&quot;dask&quot;</span>

<span class="c1"># Enable Kerberos for user-facing authentication</span>
<span class="n">c</span><span class="o">.</span><span class="n">DaskGateway</span><span class="o">.</span><span class="n">authenticator_class</span> <span class="o">=</span> <span class="s2">&quot;dask_gateway_server.auth.KerberosAuthenticator&quot;</span>
<span class="n">c</span><span class="o">.</span><span class="n">KerberosAuthenticator</span><span class="o">.</span><span class="n">keytab</span> <span class="o">=</span> <span class="s2">&quot;/etc/dask-gateway/dask.keytab&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="configure-the-server-addresses-optional">
<h3>Configure the server addresses (optional)<a class="headerlink" href="#configure-the-server-addresses-optional" title="Permalink to this headline">¶</a></h3>
<p>By default, <code class="docutils literal notranslate"><span class="pre">dask-gateway-server</span></code> will serve all traffic through
<code class="docutils literal notranslate"><span class="pre">0.0.0.0:8000</span></code>. This includes both HTTP(S) requests (REST api, dashboards,
etc…) and dask scheduler traffic.</p>
<p>If you’d like to serve at a different address, or serve web and scheduler
traffic on different ports, you can configure the following fields:</p>
<ul class="simple">
<li><p><code class="xref py py-data docutils literal notranslate"><span class="pre">c.Proxy.address</span></code> - Serves HTTP(S) traffic, defaults to <code class="docutils literal notranslate"><span class="pre">:8000</span></code>.</p></li>
<li><p><code class="xref py py-data docutils literal notranslate"><span class="pre">c.Proxy.tcp_address</span></code> - Serves dask client-to-scheduler tcp traffic,
defaults to <code class="xref py py-data docutils literal notranslate"><span class="pre">c.Proxy.address</span></code>.</p></li>
</ul>
<p>Here we configure web traffic to serve on port 8000 and scheduler traffic to
serve on port 8001:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="o">.</span><span class="n">Proxy</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="s1">&#39;:8000&#39;</span>
<span class="n">c</span><span class="o">.</span><span class="n">Proxy</span><span class="o">.</span><span class="n">tcp_address</span> <span class="o">=</span> <span class="s1">&#39;:8001&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="specify-user-python-environments">
<h3>Specify user python environments<a class="headerlink" href="#specify-user-python-environments" title="Permalink to this headline">¶</a></h3>
<p>Since the Dask workers/schedulers will be running in their own YARN containers,
you’ll need to provide a way for Python environments to be available to these
containers. You have a few options here:</p>
<ul class="simple">
<li><p>Install identical Python environments on every node</p></li>
<li><p>Archive environments to be distributed to the container at runtime (recommended)</p></li>
</ul>
<p>In either case, the Python environment requires at least the
<code class="docutils literal notranslate"><span class="pre">dask-gateway</span></code> package be installed to work properly.</p>
<div class="section" id="using-a-local-environment">
<h4>Using a local environment<a class="headerlink" href="#using-a-local-environment" title="Permalink to this headline">¶</a></h4>
<p>If you’ve installed identical Python environments on every node, you only need
to configure <code class="docutils literal notranslate"><span class="pre">dask-gateway-server</span></code> to use the provided Python. This could be
done a few different ways:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Configure the paths to the dask-scheduler/dask-worker CLIs</span>
<span class="n">c</span><span class="o">.</span><span class="n">YarnClusterConfig</span><span class="o">.</span><span class="n">scheduler_cmd</span> <span class="o">=</span> <span class="s2">&quot;/path/to/dask-scheduler&quot;</span>
<span class="n">c</span><span class="o">.</span><span class="n">YarnClusterConfig</span><span class="o">.</span><span class="n">worker_cmd</span> <span class="o">=</span> <span class="s2">&quot;/path/to/dask-worker&quot;</span>

<span class="c1"># OR</span>
<span class="c1"># Activate a local conda environment before startup</span>
<span class="n">c</span><span class="o">.</span><span class="n">YarnClusterConfig</span><span class="o">.</span><span class="n">scheduler_setup</span> <span class="o">=</span> <span class="s1">&#39;source /path/to/miniconda/bin/activate /path/to/environment&#39;</span>
<span class="n">c</span><span class="o">.</span><span class="n">YarnClusterConfig</span><span class="o">.</span><span class="n">worker_setup</span> <span class="o">=</span> <span class="s1">&#39;source /path/to/miniconda/bin/activate /path/to/environment&#39;</span>

<span class="c1"># OR</span>
<span class="c1"># Activate a virtual environment before startup</span>
<span class="n">c</span><span class="o">.</span><span class="n">YarnClusterConfig</span><span class="o">.</span><span class="n">scheduler_setup</span> <span class="o">=</span> <span class="s1">&#39;source /path/to/your/environment/bin/activate&#39;</span>
<span class="n">c</span><span class="o">.</span><span class="n">YarnClusterConfig</span><span class="o">.</span><span class="n">worker_setup</span> <span class="o">=</span> <span class="s1">&#39;source /path/to/your/environment/bin/activate&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="using-an-archived-environment">
<h4>Using an archived environment<a class="headerlink" href="#using-an-archived-environment" title="Permalink to this headline">¶</a></h4>
<p>YARN also provides mechanisms to “localize” files/archives to a container
before starting the application. This can be used to distribute Python
environments at runtime. This approach is appealing in that it doesn’t require
installing anything throughout the cluster, and allows for centrally managing
user’s Python environments.</p>
<p>Packaging environments for distribution is usually accomplished using</p>
<ul class="simple">
<li><p><a class="reference external" href="https://conda.github.io/conda-pack/">conda-pack</a> for <a class="reference external" href="https://docs.conda.io/">conda</a> environments</p></li>
<li><p><a class="reference external" href="https://jcristharif.com/venv-pack/">venv-pack</a>  for virtual environments (both <a class="reference external" href="https://virtualenv.pypa.io/en/stable/">venv</a> and <a class="reference external" href="https://virtualenv.pypa.io/en/stable/">virtualenv</a> supported)</p></li>
</ul>
<p>Both are tools for taking an environment and creating an archive of it in a way
that (most) absolute paths in any libraries or scripts are altered to be
relocatable. This archive then can be distributed with your application, and
will be automatically extracted during <a class="reference external" href="https://blog.cloudera.com/resource-localization-in-yarn-deep-dive/">YARN resource localization</a></p>
<p>Below we demonstrate creating and packaging a Conda environment containing
<code class="docutils literal notranslate"><span class="pre">dask-gateway</span></code>, as well as <code class="docutils literal notranslate"><span class="pre">pandas</span></code> and <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code>. Additional
packages could be added as needed.</p>
<p><strong>Packaging a conda environment with conda-pack</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make a folder for storing the conda environments locally</span>
$<span class="w"> </span>mkdir<span class="w"> </span>/opt/dask-gateway/envs

<span class="c1"># Create a new conda environment</span>
$<span class="w"> </span>conda<span class="w"> </span>create<span class="w"> </span>-c<span class="w"> </span>conda-forge<span class="w"> </span>-y<span class="w"> </span>-p<span class="w"> </span>/opt/dask-gateway/envs/example
...

<span class="c1"># Activate the environment</span>
$<span class="w"> </span>conda<span class="w"> </span>activate<span class="w"> </span>/opt/dask-gateway/envs/example

<span class="c1"># Install dask-gateway, along with any other packages</span>
$<span class="w"> </span>conda<span class="w"> </span>install<span class="w"> </span>-c<span class="w"> </span>conda-forge<span class="w"> </span>-y<span class="w"> </span>dask-gateway<span class="w"> </span>pandas<span class="w"> </span>scikit-learn<span class="w"> </span>conda-pack

<span class="c1"># Package the environment into example.tar.gz</span>
$<span class="w"> </span>conda<span class="w"> </span>pack<span class="w"> </span>-o<span class="w"> </span>example.tar.gz
Collecting<span class="w"> </span>packages...
Packing<span class="w"> </span>environment<span class="w"> </span>at<span class="w"> </span><span class="s1">&#39;/opt/dask-gateway/envs/example&#39;</span><span class="w"> </span>to<span class="w"> </span><span class="s1">&#39;example.tar.gz&#39;</span>
<span class="o">[</span><span class="c1">########################################] | 100% Completed | 17.9s</span>
</pre></div>
</div>
<p><strong>Using the packaged environment</strong></p>
<p>It is recommended to upload the environments to some directory on HDFS
beforehand, to avoid repeating the upload cost for every user. This directory
should be readable by all users, but writable only by the admin user managing
Python environments (here we’ll use the <code class="docutils literal notranslate"><span class="pre">dask</span></code> user, and create a
<code class="docutils literal notranslate"><span class="pre">/dask-gateway</span></code> directory).</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>hdfs<span class="w"> </span>dfs<span class="w"> </span>-mkdir<span class="w"> </span>-p<span class="w"> </span>/dask-gateway
$<span class="w"> </span>hdfs<span class="w"> </span>dfs<span class="w"> </span>-chown<span class="w"> </span>dask<span class="w"> </span>/dask-gateway
$<span class="w"> </span>hdfs<span class="w"> </span>dfs<span class="w"> </span>-chmod<span class="w"> </span><span class="m">755</span><span class="w"> </span>/dask-gateway
</pre></div>
</div>
<p>Uploading our already packaged environment to hdfs:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>hdfs<span class="w"> </span>dfs<span class="w"> </span>-put<span class="w"> </span>/opt/dask-gateway/envs/example.tar.gz<span class="w"> </span>/dask-gateway/example.tar.gz
</pre></div>
</div>
<p>To use the packaged environment with <code class="docutils literal notranslate"><span class="pre">dask-gateway-server</span></code>, you need to
include the archive in <code class="docutils literal notranslate"><span class="pre">YarnClusterConfig.localize_files</span></code>, and activate the
environment in
<code class="docutils literal notranslate"><span class="pre">YarnClusterConfig.scheduler_setup</span></code>/<code class="docutils literal notranslate"><span class="pre">YarnClusterConfig.worker_setup</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="o">.</span><span class="n">YarnClusterConfig</span><span class="o">.</span><span class="n">localize_files</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;environment&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="s1">&#39;hdfs:///dask-gateway/example.tar.gz&#39;</span><span class="p">,</span>
        <span class="s1">&#39;visibility&#39;</span><span class="p">:</span> <span class="s1">&#39;public&#39;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">c</span><span class="o">.</span><span class="n">YarnClusterConfig</span><span class="o">.</span><span class="n">scheduler_setup</span> <span class="o">=</span> <span class="s1">&#39;source environment/bin/activate&#39;</span>
<span class="n">c</span><span class="o">.</span><span class="n">YarnClusterConfig</span><span class="o">.</span><span class="n">worker_setup</span> <span class="o">=</span> <span class="s1">&#39;source environment/bin/activate&#39;</span>
</pre></div>
</div>
<p>Note that we set <code class="docutils literal notranslate"><span class="pre">visibility</span></code> to <code class="docutils literal notranslate"><span class="pre">public</span></code> for the environment, so that
multiple users can all share the same localized environment (reducing the cost
of moving the environments around).</p>
<p>For more information, see the <a class="reference external" href="https://jcristharif.com/skein/distributing-files.html">Skein documentation on distributing files</a>.</p>
</div>
</div>
<div class="section" id="additional-configuration-options">
<h3>Additional configuration options<a class="headerlink" href="#additional-configuration-options" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">dask-gateway-server</span></code> has several additional configuration fields. See the
<a class="reference internal" href="api-server.html"><span class="doc">Configuration Reference</span></a> docs (specifically <a class="reference internal" href="api-server.html#yarn-config"><span class="std std-ref">the yarn configuration docs</span></a>) for more information on all available options. At a minimum
you’ll probably want to configure the worker resource limits, as well as which
YARN queue to use.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># The resource limits for a worker</span>
<span class="n">c</span><span class="o">.</span><span class="n">YarnClusterConfig</span><span class="o">.</span><span class="n">worker_memory</span> <span class="o">=</span> <span class="s1">&#39;4 G&#39;</span>
<span class="n">c</span><span class="o">.</span><span class="n">YarnClusterConfig</span><span class="o">.</span><span class="n">worker_cores</span> <span class="o">=</span> <span class="mi">2</span>

<span class="c1"># The YARN queue to use</span>
<span class="n">c</span><span class="o">.</span><span class="n">YarnClusterConfig</span><span class="o">.</span><span class="n">queue</span> <span class="o">=</span> <span class="s1">&#39;...&#39;</span>
</pre></div>
</div>
<p>If your cluster is under high load (and jobs may be slow to start), you may
also want to increase the cluster/worker timeout values:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Increase startup timeouts to 5 min (600 seconds) each</span>
<span class="n">c</span><span class="o">.</span><span class="n">YarnClusterConfig</span><span class="o">.</span><span class="n">cluster_start_timeout</span> <span class="o">=</span> <span class="mi">600</span>
<span class="n">c</span><span class="o">.</span><span class="n">YarnClusterConfig</span><span class="o">.</span><span class="n">worker_start_timeout</span> <span class="o">=</span> <span class="mi">600</span>
</pre></div>
</div>
</div>
<div class="section" id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<p>In summary, an example <code class="docutils literal notranslate"><span class="pre">dask_gateway_config.py</span></code> configuration might look
like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Configure the gateway to use YARN as the backend</span>
<span class="n">c</span><span class="o">.</span><span class="n">DaskGateway</span><span class="o">.</span><span class="n">backend_class</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;dask_gateway_server.backends.yarn.YarnBackend&quot;</span>
<span class="p">)</span>

<span class="c1"># Specify the location of the keytab file, and the principal name</span>
<span class="n">c</span><span class="o">.</span><span class="n">YarnBackend</span><span class="o">.</span><span class="n">keytab</span> <span class="o">=</span> <span class="s2">&quot;/etc/dask-gateway/dask.keytab&quot;</span>
<span class="n">c</span><span class="o">.</span><span class="n">YarnBackend</span><span class="o">.</span><span class="n">principal</span> <span class="o">=</span> <span class="s2">&quot;dask&quot;</span>

<span class="c1"># Enable Kerberos for user-facing authentication</span>
<span class="n">c</span><span class="o">.</span><span class="n">DaskGateway</span><span class="o">.</span><span class="n">authenticator_class</span> <span class="o">=</span> <span class="s2">&quot;dask_gateway_server.auth.KerberosAuthenticator&quot;</span>
<span class="n">c</span><span class="o">.</span><span class="n">KerberosAuthenticator</span><span class="o">.</span><span class="n">keytab</span> <span class="o">=</span> <span class="s2">&quot;/etc/dask-gateway/dask.keytab&quot;</span>

<span class="c1"># Specify location of the archived Python environment</span>
<span class="n">c</span><span class="o">.</span><span class="n">YarnClusterConfig</span><span class="o">.</span><span class="n">localize_files</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;environment&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="s1">&#39;hdfs:///dask-gateway/example.tar.gz&#39;</span><span class="p">,</span>
        <span class="s1">&#39;visibility&#39;</span><span class="p">:</span> <span class="s1">&#39;public&#39;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">c</span><span class="o">.</span><span class="n">YarnClusterConfig</span><span class="o">.</span><span class="n">scheduler_setup</span> <span class="o">=</span> <span class="s1">&#39;source environment/bin/activate&#39;</span>
<span class="n">c</span><span class="o">.</span><span class="n">YarnClusterConfig</span><span class="o">.</span><span class="n">worker_setup</span> <span class="o">=</span> <span class="s1">&#39;source environment/bin/activate&#39;</span>

<span class="c1"># Limit resources for a single worker</span>
<span class="n">c</span><span class="o">.</span><span class="n">YarnClusterConfig</span><span class="o">.</span><span class="n">worker_memory</span> <span class="o">=</span> <span class="s1">&#39;4 G&#39;</span>
<span class="n">c</span><span class="o">.</span><span class="n">YarnClusterConfig</span><span class="o">.</span><span class="n">worker_cores</span> <span class="o">=</span> <span class="mi">2</span>

<span class="c1"># Specify the YARN queue to use</span>
<span class="n">c</span><span class="o">.</span><span class="n">YarnClusterConfig</span><span class="o">.</span><span class="n">queue</span> <span class="o">=</span> <span class="s1">&#39;dask&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="open-relevant-port-s">
<h2>Open relevant port(s)<a class="headerlink" href="#open-relevant-port-s" title="Permalink to this headline">¶</a></h2>
<p>For users to access the gateway server, they’ll need access to the public
port(s) set in <a class="reference internal" href="#configure-the-server-addresses-optional">Configure the server addresses (optional)</a> above (by default
this is port <code class="docutils literal notranslate"><span class="pre">8000</span></code>). How to expose ports is system specific - cluster
administrators should determine how best to perform this task.</p>
</div>
<div class="section" id="start-dask-gateway-server">
<h2>Start dask-gateway-server<a class="headerlink" href="#start-dask-gateway-server" title="Permalink to this headline">¶</a></h2>
<p>At this point you should be able to start the gateway server as the <code class="docutils literal notranslate"><span class="pre">dask</span></code>
user using your created configuration file. The <code class="docutils literal notranslate"><span class="pre">dask-gateway-server</span></code> process
will be a long running process - how you intend to manage it (<code class="docutils literal notranslate"><span class="pre">supervisord</span></code>,
etc…) is system specific. The requirements are:</p>
<ul class="simple">
<li><p>Start with <code class="docutils literal notranslate"><span class="pre">dask</span></code> as the user</p></li>
<li><p>Start with <code class="docutils literal notranslate"><span class="pre">/var/dask-gateway</span></code> as the working directory</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">/opt/dask-gateway/miniconda/bin</span></code> to path</p></li>
<li><p>Specify the configuration file location with <code class="docutils literal notranslate"><span class="pre">-f</span> <span class="pre">/etc/dask-gateway/dask_gateway_config.py</span></code></p></li>
</ul>
<p>For ease, we recommend creating a small bash script stored at
<code class="docutils literal notranslate"><span class="pre">/opt/dask-gateway/start-dask-gateway</span></code> to set this up:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env bash</span>

<span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;/opt/dask-gateway/miniconda/bin:</span><span class="nv">$PATH</span><span class="s2">&quot;</span>
<span class="nb">cd</span><span class="w"> </span>/var/dask-gateway
dask-gateway-server<span class="w"> </span>-f<span class="w"> </span>/etc/dask-gateway/dask_gateway_config.py
</pre></div>
</div>
<p>For <em>testing</em> here’s how you might start <code class="docutils literal notranslate"><span class="pre">dask-gateway-server</span></code> manually:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>/var/dask-gateway
$<span class="w"> </span>sudo<span class="w"> </span>-iu<span class="w"> </span>dask<span class="w"> </span>/opt/dask-gateway/start-dask-gateway
</pre></div>
</div>
</div>
<div class="section" id="validate-things-are-working">
<h2>Validate things are working<a class="headerlink" href="#validate-things-are-working" title="Permalink to this headline">¶</a></h2>
<p>If the server started with no errors, you’ll want to check that things are
working properly. The easiest way to do this is to try connecting as a user.</p>
<p>A user’s environment requires the <code class="docutils literal notranslate"><span class="pre">dask-gateway</span></code> library be installed. If
your cluster is secured with kerberos, you’ll also need to install
<code class="docutils literal notranslate"><span class="pre">dask-gateway-kerberos</span></code>.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install the dask-gateway client library</span>
$<span class="w"> </span>conda<span class="w"> </span>create<span class="w"> </span>-n<span class="w"> </span>dask-gateway<span class="w"> </span>-c<span class="w"> </span>conda-forge<span class="w"> </span>dask-gateway

<span class="c1"># If kerberos is enabled, also install dask-gateway-kerberos</span>
$<span class="w"> </span>conda<span class="w"> </span>create<span class="w"> </span>-n<span class="w"> </span>dask-gateway<span class="w"> </span>-c<span class="w"> </span>conda-forge<span class="w"> </span>dask-gateway-kerberos
</pre></div>
</div>
<p>You can connect to the gateway by creating a <a class="reference internal" href="api-client.html#dask_gateway.Gateway" title="dask_gateway.Gateway"><code class="xref py py-class docutils literal notranslate"><span class="pre">dask_gateway.Gateway</span></code></a>
object, specifying the public address (note that if you configured
<code class="xref py py-data docutils literal notranslate"><span class="pre">c.Proxy.tcp_address</span></code> you’ll also need to specify the <code class="docutils literal notranslate"><span class="pre">proxy_address</span></code>).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">dask_gateway</span> <span class="kn">import</span> <span class="n">Gateway</span>

<span class="go"># When running without kerberos</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gateway</span> <span class="o">=</span> <span class="n">Gateway</span><span class="p">(</span><span class="s2">&quot;http://public-address&quot;</span><span class="p">)</span>

<span class="go"># OR, if kerberos is enabled, you&#39;ll need to kinit and then do</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gateway</span> <span class="o">=</span> <span class="n">Gateway</span><span class="p">(</span><span class="s2">&quot;http://public-address&quot;</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="s2">&quot;kerberos&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>You should now be able to make API calls. Try
<a class="reference internal" href="api-client.html#dask_gateway.Gateway.list_clusters" title="dask_gateway.Gateway.list_clusters"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dask_gateway.Gateway.list_clusters()</span></code></a>, this should return an empty list.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">gateway</span><span class="o">.</span><span class="n">list_clusters</span><span class="p">()</span>
<span class="go">[]</span>
</pre></div>
</div>
<p>Next, see if you can create a cluster. This may take a few minutes.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cluster</span> <span class="o">=</span> <span class="n">gateway</span><span class="o">.</span><span class="n">new_cluster</span><span class="p">()</span>
</pre></div>
</div>
<p>The last thing you’ll want to check is if you can successfully connect to your
newly created cluster.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">client</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">get_client</span><span class="p">()</span>
</pre></div>
</div>
<p>If everything worked properly, you can shutdown your cluster with
<a class="reference internal" href="api-client.html#dask_gateway.GatewayCluster.shutdown" title="dask_gateway.GatewayCluster.shutdown"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dask_gateway.GatewayCluster.shutdown()</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cluster</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>


              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="install-local.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Install Locally (Quickstart)</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="install-kube.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Install on a Kubernetes Cluster</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Jim Crist-Harif<br/>
    
        &copy; Copyright 2021, Jim Crist-Harif.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

<!-- Google Tag Manager -->
<script>
  (function (w, d, s, l, i) {
    w[l] = w[l] || [];
    w[l].push({
      "gtm.start": new Date().getTime(),
      event: "gtm.js",
    });
    var f = d.getElementsByTagName(s)[0],
      j = d.createElement(s),
      dl = l != "dataLayer" ? "&l=" + l : "";
    j.async = true;
    j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
    f.parentNode.insertBefore(j, f);
  })(
    window,
    document,
    "script",
    "dataLayer",
    "GTM-P4GQM59"
  );
</script>
<!-- End Google Tag Manager -->

  </body>
</html>