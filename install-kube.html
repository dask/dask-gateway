 
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Install on a Kubernetes Cluster &#8212; Dask Gateway 2024.1.0 documentation</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/css/style.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx-book-theme.9d8b4a8b9bb19db25eeaddc40d639ba2.js"></script>
    <link rel="shortcut icon" href="_static/images/favicon.svg"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Install on an HPC Job Queue" href="install-jobqueue.html" />
    <link rel="prev" title="Install on a Hadoop Cluster" href="install-hadoop.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
<!-- Google Tag Manager (noscript) -->
<noscript
  ><iframe
    src="https://www.googletagmanager.com/ns.html?id=GTM-P4GQM59"
    height="0"
    width="0"
    style="display: none; visibility: hidden"
  ></iframe
></noscript>
<!-- End Google Tag Manager (noscript) -->
<nav class="dask-nav container-fluid">
  <ul>
    <li class="logo">
      <a href="https://docs.dask.org/">
        <img
          class="caption"
          src="_static/images/dask-horizontal-white.svg"
        />
      </a>
    </li>

    <li>
      <a href="https://docs.dask.org/">Dask</a>
    </li>

    <li>
      <a href="https://distributed.dask.org/">Distributed</a>
    </li>

    <li>
      <a href="https://ml.dask.org/">Dask ML</a>
    </li>

    <li>
      <a href="https://examples.dask.org/">Examples</a>
    </li>

    <li>
      <a href="https://docs.dask.org/en/latest/ecosystem.html">Ecosystem</a>
    </li>

    <li>
      <a href="https://docs.dask.org/en/latest/support.html">Community</a>
    </li>
  </ul>
</nav>


    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<div class="col-12 col-md-3 bd-sidebar site-navigation " id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Dask Gateway 2024.1.0 documentation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  For Users
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="install-user.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="usage.html">
   Usage
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="configuration-user.html">
   Configuration
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Admin - Installation
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="install-local.html">
   Install Locally (Quickstart)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="install-hadoop.html">
   Install on a Hadoop Cluster
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Install on a Kubernetes Cluster
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="install-jobqueue.html">
   Install on an HPC Job Queue
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Admin - Customization
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="authentication.html">
   Authentication
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="security.html">
   Security settings
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cluster-options.html">
   Exposing Cluster Options
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="resource-limits.html">
   Cluster Resource Limits
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Reference
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="api-client.html">
   Client API
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="api-server.html">
   Configuration Reference
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="develop.html">
   Development
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="changelog.html">
   Changelog
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<!-- This is an invisible pixel that we watch to see if we've scrolled. -->
<div class="sbt-scroll-pixel-helper"></div>
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            <div class="topbar-left">
                
                <label class="nav-toggle-button" for="__navigation">
                    <div class="visually-hidden">Toggle navigation</div>
                    <i class="fas fa-bars"></i>
                </label>
                
            </div>
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/install-kube.rst.txt"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.rst</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#architecture">
   Architecture
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-a-kubernetes-cluster-optional">
   Create a Kubernetes Cluster (optional)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#install-helm">
   Install Helm
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#install-the-dask-gateway-helm-chart">
   Install the Dask-Gateway Helm chart
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#configuration">
     Configuration
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#install-the-helm-chart">
     Install the Helm Chart
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#connecting-to-the-gateway">
   Connecting to the gateway
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#shutting-everything-down">
   Shutting everything down
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#additional-configuration">
   Additional configuration
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-a-custom-image">
     Using a custom image
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-extrapodconfig-extracontainerconfig">
     Using
     <code class="docutils literal notranslate">
      <span class="pre">
       extraPodConfig
      </span>
     </code>
     /
     <code class="docutils literal notranslate">
      <span class="pre">
       extraContainerConfig
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-extraconfig">
     Using
     <code class="docutils literal notranslate">
      <span class="pre">
       extraConfig
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#authenticating-with-jupyterhub">
     Authenticating with JupyterHub
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#helm-chart-reference">
   Helm chart reference
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Install on a Kubernetes Cluster</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#architecture">
   Architecture
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-a-kubernetes-cluster-optional">
   Create a Kubernetes Cluster (optional)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#install-helm">
   Install Helm
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#install-the-dask-gateway-helm-chart">
   Install the Dask-Gateway Helm chart
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#configuration">
     Configuration
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#install-the-helm-chart">
     Install the Helm Chart
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#connecting-to-the-gateway">
   Connecting to the gateway
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#shutting-everything-down">
   Shutting everything down
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#additional-configuration">
   Additional configuration
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-a-custom-image">
     Using a custom image
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-extrapodconfig-extracontainerconfig">
     Using
     <code class="docutils literal notranslate">
      <span class="pre">
       extraPodConfig
      </span>
     </code>
     /
     <code class="docutils literal notranslate">
      <span class="pre">
       extraContainerConfig
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-extraconfig">
     Using
     <code class="docutils literal notranslate">
      <span class="pre">
       extraConfig
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#authenticating-with-jupyterhub">
     Authenticating with JupyterHub
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#helm-chart-reference">
   Helm chart reference
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="section" id="install-on-a-kubernetes-cluster">
<h1>Install on a Kubernetes Cluster<a class="headerlink" href="#install-on-a-kubernetes-cluster" title="Permalink to this headline">¶</a></h1>
<p>Here we provide instructions for installing and configuring
<code class="docutils literal notranslate"><span class="pre">dask-gateway-server</span></code> on a <a class="reference external" href="https://kubernetes.io/">Kubernetes Cluster</a>.</p>
<div class="section" id="architecture">
<h2>Architecture<a class="headerlink" href="#architecture" title="Permalink to this headline">¶</a></h2>
<p>When running on Kubernetes, Dask Gateway is composed of the following components:</p>
<ul class="simple">
<li><p>Multiple active <strong>Dask Clusters</strong> (potentially more than one per user)</p></li>
<li><p>A <strong>Traefik Proxy</strong> for proxying both the connection between the user’s client
and their respective scheduler, and the Dask Web UI for each cluster</p></li>
<li><p>A <strong>Gateway API Server</strong> that handles user API requests</p></li>
<li><p>A <strong>Gateway Controller</strong> for managing the kubernetes objects used by each
cluster (e.g. pods, secrets, etc…).</p></li>
</ul>
<a class="reference internal image-reference" href="_images/architecture-k8s.svg"><img alt="Dask-Gateway high-level kubernetes architecture" class="align-center" src="_images/architecture-k8s.svg" width="90%" /></a>
<p>Both the Traefik Proxy deployment and the Gateway API Server deployment can be
scaled to multiple replicas, for increased availability and scalability.</p>
<p>The Dask Gateway pods running on Kubernetes include the following:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">api</span></code>: The <strong>Gateway API Server</strong></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">traefik</span></code>: The <strong>Traefik Proxy</strong></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">controller</span></code>: The Kubernetes <strong>Gateway Controller</strong> for managing Dask-Gateway resources</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">scheduler</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">worker</span></code>: User’s Dask Scheduler and Worker</p></li>
</ul>
<p>Network communications happen in the following manner:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">traefik</span></code> pods proxy connections to the <code class="docutils literal notranslate"><span class="pre">api</span></code> pods on port 8000, and <code class="docutils literal notranslate"><span class="pre">scheduler</span></code> pods on ports 8786 and 8787.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">api</span></code> pods send api requests to the <code class="docutils literal notranslate"><span class="pre">scheduler</span></code> pods over port 8788.</p></li>
<li><p>If using JupyterHub Auth., the <code class="docutils literal notranslate"><span class="pre">api</span></code> pod sends requests to the JupyterHub server to authenticate.</p></li>
<li><p>Depending on the configuration, requests go directly to the JupyterHub pods through service lookup or through the JupyterHub Proxy.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">worker</span></code> pods communicate with the <code class="docutils literal notranslate"><span class="pre">scheduler</span></code> on port 8786.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">traefik</span></code> pods proxy <code class="docutils literal notranslate"><span class="pre">worker</span></code> communications on port 8787 for the dashboard.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">worker</span></code> pods listen for incoming communications on a random high port, which the <code class="docutils literal notranslate"><span class="pre">scheduler</span></code> opens connections back to.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">worker</span></code> pods also communicate with each other on these random high ports.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">scheduler</span></code> pods send heartbeat requests to the <code class="docutils literal notranslate"><span class="pre">api</span></code> server pods using the <code class="docutils literal notranslate"><span class="pre">api</span></code> service DNS name on port 8000.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">controller</span></code> pod only communicates to the Kubernetes API and receives no inbound traffic.</p></li>
</ul>
</div>
<div class="section" id="create-a-kubernetes-cluster-optional">
<h2>Create a Kubernetes Cluster (optional)<a class="headerlink" href="#create-a-kubernetes-cluster-optional" title="Permalink to this headline">¶</a></h2>
<p>If you don’t already have a cluster running, you’ll want to create one. There
are plenty of guides online for how to do this. We recommend following the
excellent <a class="reference external" href="https://zero-to-jupyterhub.readthedocs.io/en/latest/create-k8s-cluster.html">documentation provided by zero-to-jupyterhub-k8s</a>.</p>
</div>
<div class="section" id="install-helm">
<h2>Install Helm<a class="headerlink" href="#install-helm" title="Permalink to this headline">¶</a></h2>
<p>If you don’t already have <a class="reference external" href="https://helm.sh/">Helm</a> installed, you’ll need to install it locally.
As with above, there are plenty of instructional materials online for doing
this. We recommend following the <a class="reference external" href="https://zero-to-jupyterhub.readthedocs.io/en/stable/kubernetes/setup-helm.html">guide provided by zero-to-jupyterhub-k8s</a>.</p>
</div>
<div class="section" id="install-the-dask-gateway-helm-chart">
<h2>Install the Dask-Gateway Helm chart<a class="headerlink" href="#install-the-dask-gateway-helm-chart" title="Permalink to this headline">¶</a></h2>
<p>At this point you should have a Kubernetes cluster. You are now ready to install
the Dask-Gateway Helm chart on your cluster.</p>
<div class="section" id="configuration">
<h3>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h3>
<p>The Helm chart provides access to configure most aspects of the
<code class="docutils literal notranslate"><span class="pre">dask-gateway-server</span></code>. These are provided via a configuration YAML file (the
name of this file doesn’t matter, we’ll use <code class="docutils literal notranslate"><span class="pre">config.yaml</span></code>).</p>
<p>The Helm chart exposes many configuration values, see the <a class="reference external" href="https://github.com/dask/dask-gateway/blob/main/resources/helm/dask-gateway/values.yaml">default
values.yaml file</a> for more information.</p>
</div>
<div class="section" id="install-the-helm-chart">
<h3>Install the Helm Chart<a class="headerlink" href="#install-the-helm-chart" title="Permalink to this headline">¶</a></h3>
<p>To install the Dask-Gateway Helm chart, run the following command:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nv">RELEASE</span><span class="o">=</span>dask-gateway
<span class="nv">NAMESPACE</span><span class="o">=</span>dask-gateway

helm<span class="w"> </span>upgrade<span class="w"> </span><span class="nv">$RELEASE</span><span class="w"> </span>dask-gateway<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--repo<span class="o">=</span>https://helm.dask.org<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--install<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--namespace<span class="w"> </span><span class="nv">$NAMESPACE</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--values<span class="w"> </span>path/to/your/config.yaml
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">RELEASE</span></code> is the <a class="reference external" href="https://helm.sh/docs/glossary/#release">Helm release name</a> to use (we suggest <code class="docutils literal notranslate"><span class="pre">dask-gateway</span></code>,
but any release name is fine).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NAMESPACE</span></code> is the <a class="reference external" href="https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/">Kubernetes namespace</a> to install the gateway into (we
suggest <code class="docutils literal notranslate"><span class="pre">dask-gateway</span></code>, but any namespace is fine).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">path/to/your/config.yaml</span></code> is the path to your <code class="docutils literal notranslate"><span class="pre">config.yaml</span></code> file created
above.</p></li>
</ul>
<p>Running this command may take some time, as resources are created and images
are downloaded. When everything is ready, running the following command will
show the <code class="docutils literal notranslate"><span class="pre">EXTERNAL-IP</span></code> addresses for the <code class="docutils literal notranslate"><span class="pre">LoadBalancer</span></code> service (highlighted
below).</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>kubectl<span class="w"> </span>get<span class="w"> </span>service<span class="w"> </span>--namespace<span class="w"> </span>dask-gateway

NAME<span class="w">                              </span>TYPE<span class="w">           </span>CLUSTER-IP<span class="w">      </span>EXTERNAL-IP<span class="w">      </span>PORT<span class="o">(</span>S<span class="o">)</span><span class="w">          </span>AGE
<span class="hll">api-&lt;RELEASE&gt;-dask-gateway<span class="w">        </span>ClusterIP<span class="w">      </span><span class="m">10</span>.51.245.233<span class="w">   </span>&lt;none&gt;<span class="w">           </span><span class="m">8000</span>/TCP<span class="w">         </span>6m54s
</span>traefik-&lt;RELEASE&gt;-dask-gateway<span class="w">    </span>LoadBalancer<span class="w">   </span><span class="m">10</span>.51.247.160<span class="w">   </span><span class="m">146</span>.148.58.187<span class="w">   </span><span class="m">80</span>:30304/TCP<span class="w">     </span>6m54s
</pre></div>
</div>
<p>You can also check to make sure the <cite>daskcluster</cite> CRD has been installed successfully:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>kubectl<span class="w"> </span>get<span class="w"> </span>daskcluster<span class="w"> </span>-o<span class="w"> </span>yaml

apiVersion:<span class="w"> </span>v1
items:<span class="w"> </span><span class="o">[]</span>
kind:<span class="w"> </span>List
metadata:
<span class="w">  </span>resourceVersion:<span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="w">  </span>selfLink:<span class="w"> </span><span class="s2">&quot;&quot;</span>
</pre></div>
</div>
<p>At this point, you have a fully running <code class="docutils literal notranslate"><span class="pre">dask-gateway-server</span></code>.</p>
</div>
</div>
<div class="section" id="connecting-to-the-gateway">
<h2>Connecting to the gateway<a class="headerlink" href="#connecting-to-the-gateway" title="Permalink to this headline">¶</a></h2>
<p>To connect to the running <code class="docutils literal notranslate"><span class="pre">dask-gateway-server</span></code>, you’ll need the external IPs
from the <code class="docutils literal notranslate"><span class="pre">traefik-*</span></code> services above. The Traefik service provides access to
API requests, proxies out the <a class="reference external" href="https://docs.dask.org/en/latest/diagnostics-distributed.html">Dask Dashboards</a>, and proxies TCP traffic
between Dask clients and schedulers. (You can also choose to have Traefik handle
scheduler traffic over a separate port, see the <a class="reference internal" href="#helm-chart-reference"><span class="std std-ref">Helm chart reference</span></a>).</p>
<p>To connect, create a <a class="reference internal" href="api-client.html#dask_gateway.Gateway" title="dask_gateway.Gateway"><code class="xref py py-class docutils literal notranslate"><span class="pre">dask_gateway.Gateway</span></code></a> object, specifying the both
addresses (the second <code class="docutils literal notranslate"><span class="pre">traefik-*</span></code> port goes under <code class="docutils literal notranslate"><span class="pre">proxy_address</span></code> if using
separate ports). Using the same values as above:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">dask_gateway</span><span class="w"> </span><span class="kn">import</span> <span class="n">Gateway</span>
<span class="n">gateway</span> <span class="o">=</span> <span class="n">Gateway</span><span class="p">(</span>
    <span class="s2">&quot;http://146.148.58.187&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>You should now be able to use the gateway client to make API calls. To verify
this, call <a class="reference internal" href="api-client.html#dask_gateway.Gateway.list_clusters" title="dask_gateway.Gateway.list_clusters"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dask_gateway.Gateway.list_clusters()</span></code></a>. This should return an
empty list as you have no clusters running yet.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">gateway</span><span class="o">.</span><span class="n">list_clusters</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="shutting-everything-down">
<h2>Shutting everything down<a class="headerlink" href="#shutting-everything-down" title="Permalink to this headline">¶</a></h2>
<p>If you’re done with the gateway, you’ll want to delete your deployment and
clean everything up. You can do this with <code class="docutils literal notranslate"><span class="pre">helm</span> <span class="pre">delete</span></code>:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>helm<span class="w"> </span>delete<span class="w"> </span><span class="nv">$RELEASE</span>
</pre></div>
</div>
</div>
<div class="section" id="additional-configuration">
<h2>Additional configuration<a class="headerlink" href="#additional-configuration" title="Permalink to this headline">¶</a></h2>
<p>Here we provide a few configuration snippets for common deployment scenarios.
For all available configuration fields see the <a class="reference internal" href="#helm-chart-reference"><span class="std std-ref">Helm chart reference</span></a>.</p>
<div class="section" id="using-a-custom-image">
<h3>Using a custom image<a class="headerlink" href="#using-a-custom-image" title="Permalink to this headline">¶</a></h3>
<p>By default schedulers/workers started by dask-gateway will use the
<code class="docutils literal notranslate"><span class="pre">daskgateway/dask-gateway</span></code> image. This is a basic image with only the minimal
dependencies installed. To use a custom image, you can configure:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">gateway.backend.image.name</span></code>: the default image name</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gateway.backend.image.tag</span></code>: the default image tag</p></li>
</ul>
<p>For an image to work with dask-gateway, it must have a compatible version of
<code class="docutils literal notranslate"><span class="pre">dask-gateway</span></code> installed (we recommend always using the same version as
deployed on the <code class="docutils literal notranslate"><span class="pre">dask-gateway-server</span></code>).</p>
<p>Additionally, we recommend using an <a class="reference external" href="https://en.wikipedia.org/wiki/Init">init process</a> in your images. This isn’t
strictly required, but running without an init process may lead to odd worker
behaviors. We recommend using <a class="reference external" href="https://github.com/krallin/tini">tini</a>, but any init process should be fine.</p>
<p>There are no other requirements for images, any image that meets the above
should work fine. You may install any additional libraries or dependencies you
require.</p>
<p>We encourage you to maintain your own image for scheduler and worker pods as
this project only provides a <a class="reference external" href="https://github.com/dask/dask-gateway/blob/main/dask-gateway/Dockerfile">minimal image</a> for testing purposes.</p>
</div>
<div class="section" id="using-extrapodconfig-extracontainerconfig">
<h3>Using <code class="docutils literal notranslate"><span class="pre">extraPodConfig</span></code>/<code class="docutils literal notranslate"><span class="pre">extraContainerConfig</span></code><a class="headerlink" href="#using-extrapodconfig-extracontainerconfig" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/">Kubernetes API</a> is large, and not all configuration fields you may want
to set on scheduler/worker pods are directly exposed by the Helm chart. To
address this, we provide a few fields for forwarding configuration directly to
the underlying kubernetes objects:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">gateway.backend.scheduler.extraPodConfig</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gateway.backend.scheduler.extraContainerConfig</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gateway.backend.worker.extraPodConfig</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gateway.backend.worker.extraContainerConfig</span></code></p></li>
</ul>
<p>These allow configuring any unexposed fields on the pod/container for
schedulers and workers respectively. Each takes a mapping of key-value pairs,
which is deep-merged with any settings set by dask-gateway itself (with
preference given to the <code class="docutils literal notranslate"><span class="pre">extra*Config</span></code> values). Note that keys should be
<code class="docutils literal notranslate"><span class="pre">camelCase</span></code> (rather than <code class="docutils literal notranslate"><span class="pre">snake_case</span></code>) to match those in the kubernetes
API.</p>
<p>For example, this can be useful for setting things like <a class="reference external" href="https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/">tolerations</a> or <a class="reference external" href="https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/">node
affinities</a> on scheduler or worker pods. Here we configure a node
anti-affinity for scheduler pods to avoid <a class="reference external" href="https://cloud.google.com/blog/products/containers-kubernetes/cutting-costs-with-google-kubernetes-engine-using-the-cluster-autoscaler-and-preemptible-vms">preemptible nodes</a>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">gateway</span><span class="p">:</span>
<span class="w">  </span><span class="nt">backend</span><span class="p">:</span>
<span class="w">    </span><span class="nt">scheduler</span><span class="p">:</span>
<span class="w">      </span><span class="nt">extraPodConfig</span><span class="p">:</span>
<span class="w">        </span><span class="nt">affinity</span><span class="p">:</span>
<span class="w">          </span><span class="nt">nodeAffinity</span><span class="p">:</span>
<span class="w">            </span><span class="nt">requiredDuringSchedulingIgnoredDuringExecution</span><span class="p">:</span>
<span class="w">              </span><span class="nt">nodeSelectorTerms</span><span class="p">:</span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">matchExpressions</span><span class="p">:</span>
<span class="w">                  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloud.google.com/gke-preemptible</span>
<span class="w">                    </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DoesNotExist</span>
</pre></div>
</div>
<p>For information on allowed fields, see the Kubernetes documentation:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podspec-v1-core">PodSpec Configuration</a></p></li>
<li><p><a class="reference external" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#container-v1-core">Container Configuration</a></p></li>
</ul>
</div>
<div class="section" id="using-extraconfig">
<h3>Using <code class="docutils literal notranslate"><span class="pre">extraConfig</span></code><a class="headerlink" href="#using-extraconfig" title="Permalink to this headline">¶</a></h3>
<p>Not all configuration options have been exposed via the helm chart. To set
unexposed options, you can use the <code class="docutils literal notranslate"><span class="pre">gateway.extraConfig</span></code> field. This takes
either:</p>
<ul class="simple">
<li><p>A single python code-block (as a string) to append to the end of the
generated <code class="docutils literal notranslate"><span class="pre">dask_gateway_config.py</span></code> file.</p></li>
<li><p>A map of keys -&gt; code-blocks (recommended). When applied in this form,
code-blocks are appended in alphabetical order by key (the keys themselves
are meaningless).  This allows merging multiple <code class="docutils literal notranslate"><span class="pre">values.yaml</span></code> files
together, as Helm can natively merge maps.</p></li>
</ul>
<p>For example, here we use <code class="docutils literal notranslate"><span class="pre">gateway.extraConfig</span></code> to set
<code class="xref py py-data docutils literal notranslate"><span class="pre">c.Backend.cluster_options</span></code>, exposing options for worker
resources and image (see <a class="reference internal" href="cluster-options.html"><span class="doc">Exposing Cluster Options</span></a> for more information).</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">gateway</span><span class="p">:</span>
<span class="w">  </span><span class="nt">extraConfig</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># Note that the key name here doesn&#39;t matter. Values in the</span>
<span class="w">    </span><span class="c1"># `extraConfig` map are concatenated, sorted by key name.</span>
<span class="w">    </span><span class="nt">clusteroptions</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">        </span><span class="no">from dask_gateway_server.options import Options, Integer, Float, String</span>

<span class="w">        </span><span class="no">def option_handler(options):</span>
<span class="w">            </span><span class="no">return {</span>
<span class="w">                </span><span class="no">&quot;worker_cores&quot;: options.worker_cores,</span>
<span class="w">                </span><span class="no">&quot;worker_memory&quot;: &quot;%fG&quot; % options.worker_memory,</span>
<span class="w">                </span><span class="no">&quot;image&quot;: options.image,</span>
<span class="w">            </span><span class="no">}</span>

<span class="w">        </span><span class="no">c.Backend.cluster_options = Options(</span>
<span class="w">            </span><span class="no">Integer(&quot;worker_cores&quot;, 2, min=1, max=4, label=&quot;Worker Cores&quot;),</span>
<span class="w">            </span><span class="no">Float(&quot;worker_memory&quot;, 4, min=1, max=8, label=&quot;Worker Memory (GiB)&quot;),</span>
<span class="w">            </span><span class="no">String(&quot;image&quot;, default=&quot;daskgateway/dask-gateway:latest&quot;, label=&quot;Image&quot;),</span>
<span class="w">            </span><span class="no">handler=option_handler,</span>
<span class="w">        </span><span class="no">)</span>
</pre></div>
</div>
<p>For information on all available configuration options, see the
<a class="reference internal" href="api-server.html"><span class="doc">Configuration Reference</span></a> (in particular, the <a class="reference internal" href="api-server.html#kube-cluster-config"><span class="std std-ref">KubeClusterConfig</span></a>
section).</p>
</div>
<div class="section" id="authenticating-with-jupyterhub">
<h3>Authenticating with JupyterHub<a class="headerlink" href="#authenticating-with-jupyterhub" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://jupyterhub.readthedocs.io/">JupyterHub</a> provides a multi-user interactive <a class="reference external" href="https://jupyter.org/">notebook</a> environment. Through
the <a class="reference external" href="https://zero-to-jupyterhub.readthedocs.io/en/latest/">zero-to-jupyterhub-k8s</a> project, many companies and institutions have setup
JuypterHub to run on Kubernetes. When deploying Dask-Gateway alongside
JupyterHub, you can configure Dask-Gateway to use JupyterHub for
authentication.</p>
<p>Configuring a dask-gateway chart with a jupyterhub chart is more straight
forward if they are installed in the same namespace for two reasons. First the
JupyterHub chart generates api tokens for registered services and puts them in a
k8s Secret that dask-gateway can make use of. Secondly dask-gateway
pods/containers can detect the k8s Service from the JupyterHub chart’s resources
in the automatically.</p>
<p>If dask-gateway <strong>is installed in the same namespace as jupyterhub</strong>, this is the
recommended configuration to use.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># jupyterhub chart configuration</span>
<span class="nt">hub</span><span class="p">:</span>
<span class="w">  </span><span class="nt">services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">dask-gateway</span><span class="p">:</span>
<span class="w">      </span><span class="nt">display</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">display</span></code> attribute hides dask-gateway from the ‘Services’ dropdown in
the JupyterHub home page as dask-gateway doesn’t offer any UI.</p>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># dask-gateway chart configuration</span>
<span class="nt">gateway</span><span class="p">:</span>
<span class="w">  </span><span class="nt">auth</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">jupyterhub</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This configuration relies on the dask-gateway chart’s default values of
<code class="docutils literal notranslate"><span class="pre">display.auth.jupyterhub.apiTokenFromSecretName</span></code> and
<code class="docutils literal notranslate"><span class="pre">display.auth.jupyterhub.apiTokenFromSecretKey</span></code> as can be inspected in the
<a class="reference external" href="https://github.com/dask/dask-gateway/blob/main/resources/helm/dask-gateway/values.yaml">default values.yaml file</a>.</p>
</div>
<p>If dask-gateway <strong>isn’t installed in the same namespace as jupyterhub</strong>, this is
the recommended configuration procedure.</p>
<p>First generate an api token to use, for example using using <code class="docutils literal notranslate"><span class="pre">openssl</span></code>:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>openssl<span class="w"> </span>rand<span class="w"> </span>-hex<span class="w"> </span><span class="m">32</span>
</pre></div>
</div>
<p>Once you have it, your configuration should look like below, where <code class="docutils literal notranslate"><span class="pre">&lt;API</span> <span class="pre">URL&gt;</span></code>
should look like <code class="docutils literal notranslate"><span class="pre">https://&lt;JUPYTERHUB-HOST&gt;:&lt;JUPYTERHUB-PORT&gt;/hub/api</span></code> and
<code class="docutils literal notranslate"><span class="pre">&lt;API</span> <span class="pre">TOKEN&gt;</span></code> should be the generated api token.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># jupyterhub chart configuration</span>
<span class="nt">hub</span><span class="p">:</span>
<span class="w">  </span><span class="nt">services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">dask-gateway</span><span class="p">:</span>
<span class="w">      </span><span class="nt">apiToken</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&lt;API</span><span class="nv"> </span><span class="s">TOKEN&gt;&quot;</span>
<span class="w">      </span><span class="nt">display</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</pre></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># dask-gateway chart configuration</span>
<span class="nt">gateway</span><span class="p">:</span>
<span class="w">  </span><span class="nt">auth</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">jupyterhub</span>
<span class="w">    </span><span class="nt">jupyterhub</span><span class="p">:</span>
<span class="w">      </span><span class="nt">apiToken</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&lt;API</span><span class="nv"> </span><span class="s">TOKEN&gt;&quot;</span>
<span class="w">      </span><span class="nt">apiUrl</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&lt;API</span><span class="nv"> </span><span class="s">URL&gt;&quot;</span>
</pre></div>
</div>
<p>With JupyterHub authentication configured, it can be used to authenticate
requests between users of the dask-gateway client and the dask-gateway server
running in the api-dask-gateway pod.</p>
<p>Dask-Gateway client users should add <code class="docutils literal notranslate"><span class="pre">auth=&quot;jupyterhub&quot;</span></code> when they create a
Gateway <a class="reference internal" href="api-client.html#dask_gateway.Gateway" title="dask_gateway.Gateway"><code class="xref py py-class docutils literal notranslate"><span class="pre">dask_gateway.Gateway</span></code></a> object, or provide configuration for
dask-gateway client to authenticate with JupyterHub.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">dask_gateway</span><span class="w"> </span><span class="kn">import</span> <span class="n">Gateway</span>
<span class="n">gateway</span> <span class="o">=</span> <span class="n">Gateway</span><span class="p">(</span>
    <span class="s2">&quot;http://146.148.58.187&quot;</span><span class="p">,</span>
    <span class="n">auth</span><span class="o">=</span><span class="s2">&quot;jupyterhub&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="helm-chart-reference">
<span id="id1"></span><h2>Helm chart reference<a class="headerlink" href="#helm-chart-reference" title="Permalink to this headline">¶</a></h2>
<p>The full <a class="reference external" href="https://github.com/dask/dask-gateway/blob/main/resources/helm/dask-gateway/values.yaml">default values.yaml file</a> for the dask-gateway Helm chart is included
here for reference:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1">## Provide a name to partially substitute for the full names of resources (will maintain the release name)</span>
<span class="c1">##</span>
<span class="nt">nameOverride</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>

<span class="c1">## Provide a name to substitute for the full names of resources</span>
<span class="c1">##</span>
<span class="nt">fullnameOverride</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>

<span class="c1"># gateway nested config relates to the api Pod and the dask-gateway-server</span>
<span class="c1"># running within it, the k8s Service exposing it, as well as the schedulers</span>
<span class="c1"># (gateway.backend.scheduler) and workers gateway.backend.worker) created by the</span>
<span class="c1"># controller when a DaskCluster k8s resource is registered.</span>
<span class="nt">gateway</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># Number of instances of the gateway-server to run</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>

<span class="w">  </span><span class="c1"># Annotations to apply to the gateway-server pods.</span>
<span class="w">  </span><span class="nt">annotations</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>

<span class="w">  </span><span class="c1"># Resource requests/limits for the gateway-server pod.</span>
<span class="w">  </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>

<span class="w">  </span><span class="c1"># Path prefix to serve dask-gateway api requests under</span>
<span class="w">  </span><span class="c1"># This prefix will be added to all routes the gateway manages</span>
<span class="w">  </span><span class="c1"># in the traefik proxy.</span>
<span class="w">  </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>

<span class="w">  </span><span class="c1"># The gateway server log level</span>
<span class="w">  </span><span class="nt">loglevel</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">INFO</span>

<span class="w">  </span><span class="c1"># The image to use for the dask-gateway-server pod (api pod)</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ghcr.io/dask/dask-gateway-server</span>
<span class="w">    </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;set-by-chartpress&quot;</span>
<span class="w">    </span><span class="nt">pullPolicy</span><span class="p">:</span>

<span class="w">  </span><span class="c1"># Add additional environment variables to the gateway pod</span>
<span class="w">  </span><span class="c1"># e.g.</span>
<span class="w">  </span><span class="c1"># env:</span>
<span class="w">  </span><span class="c1"># - name: MYENV</span>
<span class="w">  </span><span class="c1">#   value: &quot;my value&quot;</span>
<span class="w">  </span><span class="nt">env</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>

<span class="w">  </span><span class="c1"># Image pull secrets for gateway-server pod</span>
<span class="w">  </span><span class="nt">imagePullSecrets</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>

<span class="w">  </span><span class="c1"># Configuration for the gateway-server service</span>
<span class="w">  </span><span class="nt">service</span><span class="p">:</span>
<span class="w">    </span><span class="nt">annotations</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>

<span class="w">  </span><span class="nt">auth</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># The auth type to use. One of {simple, kerberos, jupyterhub, custom}.</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">simple</span>

<span class="w">    </span><span class="nt">simple</span><span class="p">:</span>
<span class="w">      </span><span class="c1"># A shared password to use for all users.</span>
<span class="w">      </span><span class="nt">password</span><span class="p">:</span>

<span class="w">    </span><span class="nt">kerberos</span><span class="p">:</span>
<span class="w">      </span><span class="c1"># Path to the HTTP keytab for this node.</span>
<span class="w">      </span><span class="nt">keytab</span><span class="p">:</span>

<span class="w">    </span><span class="nt">jupyterhub</span><span class="p">:</span>
<span class="w">      </span><span class="c1"># A JupyterHub api token for dask-gateway to use. See</span>
<span class="w">      </span><span class="c1"># https://gateway.dask.org/install-kube.html#authenticating-with-jupyterhub.</span>
<span class="w">      </span><span class="nt">apiToken</span><span class="p">:</span>

<span class="w">      </span><span class="c1"># The JupyterHub Helm chart will automatically generate a token for a</span>
<span class="w">      </span><span class="c1"># registered service. If you don&#39;t specify an apiToken explicitly as</span>
<span class="w">      </span><span class="c1"># required in dask-gateway version &lt;=2022.6.1, the dask-gateway Helm chart</span>
<span class="w">      </span><span class="c1"># will try to look for a token from a k8s Secret created by the JupyterHub</span>
<span class="w">      </span><span class="c1"># Helm chart in the same namespace. A failure to find this k8s Secret and</span>
<span class="w">      </span><span class="c1"># key will cause a MountFailure for when the api-dask-gateway pod is</span>
<span class="w">      </span><span class="c1"># starting.</span>
<span class="w">      </span><span class="nt">apiTokenFromSecretName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hub</span>
<span class="w">      </span><span class="nt">apiTokenFromSecretKey</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hub.services.dask-gateway.apiToken</span>

<span class="w">      </span><span class="c1"># JupyterHub&#39;s api url. Inferred from JupyterHub&#39;s service name if running</span>
<span class="w">      </span><span class="c1"># in the same namespace.</span>
<span class="w">      </span><span class="nt">apiUrl</span><span class="p">:</span>

<span class="w">    </span><span class="nt">custom</span><span class="p">:</span>
<span class="w">      </span><span class="c1"># The full authenticator class name.</span>
<span class="w">      </span><span class="nt">class</span><span class="p">:</span>

<span class="w">      </span><span class="c1"># Configuration fields to set on the authenticator class.</span>
<span class="w">      </span><span class="nt">config</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>

<span class="w">  </span><span class="nt">livenessProbe</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># Enables the livenessProbe.</span>
<span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="c1"># Configures the livenessProbe.</span>
<span class="w">    </span><span class="nt">initialDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">    </span><span class="nt">timeoutSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">    </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">    </span><span class="nt">failureThreshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6</span>
<span class="w">  </span><span class="nt">readinessProbe</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># Enables the readinessProbe.</span>
<span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="c1"># Configures the readinessProbe.</span>
<span class="w">    </span><span class="nt">initialDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">    </span><span class="nt">timeoutSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">    </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">    </span><span class="nt">failureThreshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>

<span class="w">  </span><span class="c1"># nodeSelector, affinity, and tolerations the for the `api` pod running dask-gateway-server</span>
<span class="w">  </span><span class="nt">nodeSelector</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<span class="w">  </span><span class="nt">affinity</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<span class="w">  </span><span class="nt">tolerations</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>

<span class="w">  </span><span class="c1"># Any extra configuration code to append to the generated `dask_gateway_config.py`</span>
<span class="w">  </span><span class="c1"># file. Can be either a single code-block, or a map of key -&gt; code-block</span>
<span class="w">  </span><span class="c1"># (code-blocks are run in alphabetical order by key, the key value itself is</span>
<span class="w">  </span><span class="c1"># meaningless). The map version is useful as it supports merging multiple</span>
<span class="w">  </span><span class="c1"># `values.yaml` files, but is unnecessary in other cases.</span>
<span class="w">  </span><span class="nt">extraConfig</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>

<span class="w">  </span><span class="c1"># backend nested configuration relates to the scheduler and worker resources</span>
<span class="w">  </span><span class="c1"># created for DaskCluster k8s resources by the controller.</span>
<span class="w">  </span><span class="nt">backend</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># The image to use for both schedulers and workers.</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ghcr.io/dask/dask-gateway</span>
<span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;set-by-chartpress&quot;</span>
<span class="w">      </span><span class="nt">pullPolicy</span><span class="p">:</span>

<span class="w">    </span><span class="c1"># Image pull secrets for a dask cluster&#39;s scheduler and worker pods</span>
<span class="w">    </span><span class="nt">imagePullSecrets</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>

<span class="w">    </span><span class="c1"># The namespace to launch dask clusters in. If not specified, defaults to</span>
<span class="w">    </span><span class="c1"># the same namespace the gateway is running in.</span>
<span class="w">    </span><span class="nt">namespace</span><span class="p">:</span>

<span class="w">    </span><span class="c1"># A mapping of environment variables to set for both schedulers and workers.</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>

<span class="w">    </span><span class="nt">scheduler</span><span class="p">:</span>
<span class="w">      </span><span class="c1"># Any extra configuration for the scheduler pod. Sets</span>
<span class="w">      </span><span class="c1"># `c.KubeClusterConfig.scheduler_extra_pod_config`.</span>
<span class="w">      </span><span class="nt">extraPodConfig</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>

<span class="w">      </span><span class="c1"># Any extra configuration for the scheduler container.</span>
<span class="w">      </span><span class="c1"># Sets `c.KubeClusterConfig.scheduler_extra_container_config`.</span>
<span class="w">      </span><span class="nt">extraContainerConfig</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>

<span class="w">      </span><span class="c1"># Cores request/limit for the scheduler.</span>
<span class="w">      </span><span class="nt">cores</span><span class="p">:</span>
<span class="w">        </span><span class="nt">request</span><span class="p">:</span>
<span class="w">        </span><span class="nt">limit</span><span class="p">:</span>

<span class="w">      </span><span class="c1"># Memory request/limit for the scheduler.</span>
<span class="w">      </span><span class="nt">memory</span><span class="p">:</span>
<span class="w">        </span><span class="nt">request</span><span class="p">:</span>
<span class="w">        </span><span class="nt">limit</span><span class="p">:</span>

<span class="w">    </span><span class="nt">worker</span><span class="p">:</span>
<span class="w">      </span><span class="c1"># Any extra configuration for the worker pod. Sets</span>
<span class="w">      </span><span class="c1"># `c.KubeClusterConfig.worker_extra_pod_config`.</span>
<span class="w">      </span><span class="nt">extraPodConfig</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>

<span class="w">      </span><span class="c1"># Any extra configuration for the worker container. Sets</span>
<span class="w">      </span><span class="c1"># `c.KubeClusterConfig.worker_extra_container_config`.</span>
<span class="w">      </span><span class="nt">extraContainerConfig</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>

<span class="w">      </span><span class="c1"># Cores request/limit for each worker.</span>
<span class="w">      </span><span class="nt">cores</span><span class="p">:</span>
<span class="w">        </span><span class="nt">request</span><span class="p">:</span>
<span class="w">        </span><span class="nt">limit</span><span class="p">:</span>

<span class="w">      </span><span class="c1"># Memory request/limit for each worker.</span>
<span class="w">      </span><span class="nt">memory</span><span class="p">:</span>
<span class="w">        </span><span class="nt">request</span><span class="p">:</span>
<span class="w">        </span><span class="nt">limit</span><span class="p">:</span>

<span class="w">      </span><span class="c1"># Number of threads available for a worker. Sets</span>
<span class="w">      </span><span class="c1"># `c.KubeClusterConfig.worker_threads`</span>
<span class="w">      </span><span class="nt">threads</span><span class="p">:</span>


<span class="c1"># controller nested config relates to the controller Pod and the</span>
<span class="c1"># dask-gateway-server running within it that makes things happen when changes to</span>
<span class="c1"># DaskCluster k8s resources are observed.</span>
<span class="nt">controller</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># Whether the controller should be deployed. Disabling the controller allows</span>
<span class="w">  </span><span class="c1"># running it locally for development/debugging purposes.</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="w">  </span><span class="c1"># Any annotations to add to the controller pod</span>
<span class="w">  </span><span class="nt">annotations</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>

<span class="w">  </span><span class="c1"># Resource requests/limits for the controller pod</span>
<span class="w">  </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>

<span class="w">  </span><span class="c1"># Image pull secrets for controller pod</span>
<span class="w">  </span><span class="nt">imagePullSecrets</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>

<span class="w">  </span><span class="c1"># The controller log level</span>
<span class="w">  </span><span class="nt">loglevel</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">INFO</span>

<span class="w">  </span><span class="c1"># Max time (in seconds) to keep around records of completed clusters.</span>
<span class="w">  </span><span class="c1"># Default is 24 hours.</span>
<span class="w">  </span><span class="nt">completedClusterMaxAge</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">86400</span>

<span class="w">  </span><span class="c1"># Time (in seconds) between cleanup tasks removing records of completed</span>
<span class="w">  </span><span class="c1"># clusters. Default is 5 minutes.</span>
<span class="w">  </span><span class="nt">completedClusterCleanupPeriod</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">600</span>

<span class="w">  </span><span class="c1"># Base delay (in seconds) for backoff when retrying after failures.</span>
<span class="w">  </span><span class="nt">backoffBaseDelay</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.1</span>

<span class="w">  </span><span class="c1"># Max delay (in seconds) for backoff when retrying after failures.</span>
<span class="w">  </span><span class="nt">backoffMaxDelay</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">300</span>

<span class="w">  </span><span class="c1"># Limit on the average number of k8s api calls per second.</span>
<span class="w">  </span><span class="nt">k8sApiRateLimit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">50</span>

<span class="w">  </span><span class="c1"># Limit on the maximum number of k8s api calls per second.</span>
<span class="w">  </span><span class="nt">k8sApiRateLimitBurst</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span>

<span class="w">  </span><span class="c1"># The image to use for the controller pod.</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ghcr.io/dask/dask-gateway-server</span>
<span class="w">    </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;set-by-chartpress&quot;</span>
<span class="w">    </span><span class="nt">pullPolicy</span><span class="p">:</span>

<span class="w">  </span><span class="c1"># Settings for nodeSelector, affinity, and tolerations for the controller pods</span>
<span class="w">  </span><span class="nt">nodeSelector</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<span class="w">  </span><span class="nt">affinity</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<span class="w">  </span><span class="nt">tolerations</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>



<span class="c1"># traefik nested config relates to the traefik Pod and Traefik running within it</span>
<span class="c1"># that is acting as a proxy for traffic towards the gateway or user created</span>
<span class="c1"># DaskCluster resources.</span>
<span class="nt">traefik</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># Number of instances of the proxy to run</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>

<span class="w">  </span><span class="c1"># Any annotations to add to the proxy pods</span>
<span class="w">  </span><span class="nt">annotations</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>

<span class="w">  </span><span class="c1"># Resource requests/limits for the proxy pods</span>
<span class="w">  </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>

<span class="w">  </span><span class="c1"># The image to use for the proxy pod</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">traefik</span>
<span class="w">    </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3.2.0&quot;</span>
<span class="w">    </span><span class="nt">pullPolicy</span><span class="p">:</span>
<span class="w">  </span><span class="nt">imagePullSecrets</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>

<span class="w">  </span><span class="c1"># Any additional arguments to forward to traefik</span>
<span class="w">  </span><span class="nt">additionalArguments</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>

<span class="w">  </span><span class="c1"># The proxy log level</span>
<span class="w">  </span><span class="nt">loglevel</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">WARN</span>

<span class="w">  </span><span class="c1"># Whether to expose the dashboard on port 9000 (enable for debugging only!)</span>
<span class="w">  </span><span class="nt">dashboard</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>

<span class="w">  </span><span class="c1"># Additional configuration for the traefik service</span>
<span class="w">  </span><span class="nt">service</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LoadBalancer</span>
<span class="w">    </span><span class="nt">annotations</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="nt">web</span><span class="p">:</span>
<span class="w">        </span><span class="c1"># The port HTTP(s) requests will be served on</span>
<span class="w">        </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">        </span><span class="nt">nodePort</span><span class="p">:</span>
<span class="w">      </span><span class="nt">tcp</span><span class="p">:</span>
<span class="w">        </span><span class="c1"># The port TCP requests will be served on. Set to `web` to share the</span>
<span class="w">        </span><span class="c1"># web service port</span>
<span class="w">        </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
<span class="w">        </span><span class="nt">nodePort</span><span class="p">:</span>

<span class="w">  </span><span class="c1"># Settings for nodeSelector, affinity, and tolerations for the traefik pods</span>
<span class="w">  </span><span class="nt">nodeSelector</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<span class="w">  </span><span class="nt">affinity</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<span class="w">  </span><span class="nt">tolerations</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>



<span class="c1"># rbac nested configuration relates to the choice of creating or replacing</span>
<span class="c1"># resources like (Cluster)Role, (Cluster)RoleBinding, and ServiceAccount.</span>
<span class="nt">rbac</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># Whether to enable RBAC.</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="w">  </span><span class="c1"># Existing names to use if ClusterRoles, ClusterRoleBindings, and</span>
<span class="w">  </span><span class="c1"># ServiceAccounts have already been created by other means (leave set to</span>
<span class="w">  </span><span class="c1"># `null` to create all required roles at install time)</span>
<span class="w">  </span><span class="nt">controller</span><span class="p">:</span>
<span class="w">    </span><span class="nt">serviceAccountName</span><span class="p">:</span>

<span class="w">  </span><span class="nt">gateway</span><span class="p">:</span>
<span class="w">    </span><span class="nt">serviceAccountName</span><span class="p">:</span>

<span class="w">  </span><span class="nt">traefik</span><span class="p">:</span>
<span class="w">    </span><span class="nt">serviceAccountName</span><span class="p">:</span>



<span class="c1"># global nested configuration is accessible by all Helm charts that may depend</span>
<span class="c1"># on each other, but not used by this Helm chart. An entry is created here to</span>
<span class="c1"># validate its use and catch YAML typos via this configurations associated JSON</span>
<span class="c1"># schema.</span>
<span class="nt">global</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
</pre></div>
</div>
</div>
</div>


              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="install-hadoop.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Install on a Hadoop Cluster</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="install-jobqueue.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Install on an HPC Job Queue</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Jim Crist-Harif<br/>
    
        &copy; Copyright 2021, Jim Crist-Harif.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

<!-- Google Tag Manager -->
<script>
  (function (w, d, s, l, i) {
    w[l] = w[l] || [];
    w[l].push({
      "gtm.start": new Date().getTime(),
      event: "gtm.js",
    });
    var f = d.getElementsByTagName(s)[0],
      j = d.createElement(s),
      dl = l != "dataLayer" ? "&l=" + l : "";
    j.async = true;
    j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
    f.parentNode.insertBefore(j, f);
  })(
    window,
    document,
    "script",
    "dataLayer",
    "GTM-P4GQM59"
  );
</script>
<!-- End Google Tag Manager -->

  </body>
</html>