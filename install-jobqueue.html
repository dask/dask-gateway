 
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Install on an HPC Job Queue &#8212; Dask Gateway 2024.1.0 documentation</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/css/style.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx-book-theme.9d8b4a8b9bb19db25eeaddc40d639ba2.js"></script>
    <link rel="shortcut icon" href="_static/images/favicon.svg"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Authentication" href="authentication.html" />
    <link rel="prev" title="Install on a Kubernetes Cluster" href="install-kube.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
<!-- Google Tag Manager (noscript) -->
<noscript
  ><iframe
    src="https://www.googletagmanager.com/ns.html?id=GTM-P4GQM59"
    height="0"
    width="0"
    style="display: none; visibility: hidden"
  ></iframe
></noscript>
<!-- End Google Tag Manager (noscript) -->
<nav class="dask-nav container-fluid">
  <ul>
    <li class="logo">
      <a href="https://docs.dask.org/">
        <img
          class="caption"
          src="_static/images/dask-horizontal-white.svg"
        />
      </a>
    </li>

    <li>
      <a href="https://docs.dask.org/">Dask</a>
    </li>

    <li>
      <a href="https://distributed.dask.org/">Distributed</a>
    </li>

    <li>
      <a href="https://ml.dask.org/">Dask ML</a>
    </li>

    <li>
      <a href="https://examples.dask.org/">Examples</a>
    </li>

    <li>
      <a href="https://docs.dask.org/en/latest/ecosystem.html">Ecosystem</a>
    </li>

    <li>
      <a href="https://docs.dask.org/en/latest/support.html">Community</a>
    </li>
  </ul>
</nav>


    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<div class="col-12 col-md-3 bd-sidebar site-navigation " id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Dask Gateway 2024.1.0 documentation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  For Users
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="install-user.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="usage.html">
   Usage
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="configuration-user.html">
   Configuration
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Admin - Installation
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="install-local.html">
   Install Locally (Quickstart)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="install-hadoop.html">
   Install on a Hadoop Cluster
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="install-kube.html">
   Install on a Kubernetes Cluster
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Install on an HPC Job Queue
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Admin - Customization
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="authentication.html">
   Authentication
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="security.html">
   Security settings
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cluster-options.html">
   Exposing Cluster Options
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="resource-limits.html">
   Cluster Resource Limits
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Reference
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="api-client.html">
   Client API
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="api-server.html">
   Configuration Reference
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="develop.html">
   Development
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="changelog.html">
   Changelog
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<!-- This is an invisible pixel that we watch to see if we've scrolled. -->
<div class="sbt-scroll-pixel-helper"></div>
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            <div class="topbar-left">
                
                <label class="nav-toggle-button" for="__navigation">
                    <div class="visually-hidden">Toggle navigation</div>
                    <i class="fas fa-bars"></i>
                </label>
                
            </div>
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/install-jobqueue.rst.txt"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.rst</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-a-user-account">
   Create a user account
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-install-directories">
   Create install directories
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#install-a-python-environment">
   Install a python environment
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#install-dask-gateway-server">
   Install dask-gateway-server
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#enable-permissions-for-the-dask-user">
   Enable permissions for the
   <code class="docutils literal notranslate">
    <span class="pre">
     dask
    </span>
   </code>
   user
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#configure-dask-gateway-server">
   Configure dask-gateway-server
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#specify-backend">
     Specify backend
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#configure-the-server-addresses-optional">
     Configure the server addresses (optional)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#specify-user-python-environments">
     Specify user python environments
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#using-a-fixed-environment-path">
       Using a fixed environment path
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#user-configurable-python-environments">
       User-configurable python environments
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#additional-configuration-options">
     Additional configuration options
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example">
     Example
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#open-relevant-ports">
   Open relevant ports
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#start-dask-gateway-server">
   Start dask-gateway-server
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#validate-things-are-working">
   Validate things are working
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Install on an HPC Job Queue</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-a-user-account">
   Create a user account
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-install-directories">
   Create install directories
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#install-a-python-environment">
   Install a python environment
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#install-dask-gateway-server">
   Install dask-gateway-server
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#enable-permissions-for-the-dask-user">
   Enable permissions for the
   <code class="docutils literal notranslate">
    <span class="pre">
     dask
    </span>
   </code>
   user
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#configure-dask-gateway-server">
   Configure dask-gateway-server
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#specify-backend">
     Specify backend
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#configure-the-server-addresses-optional">
     Configure the server addresses (optional)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#specify-user-python-environments">
     Specify user python environments
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#using-a-fixed-environment-path">
       Using a fixed environment path
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#user-configurable-python-environments">
       User-configurable python environments
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#additional-configuration-options">
     Additional configuration options
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example">
     Example
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#open-relevant-ports">
   Open relevant ports
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#start-dask-gateway-server">
   Start dask-gateway-server
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#validate-things-are-working">
   Validate things are working
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="section" id="install-on-an-hpc-job-queue">
<h1>Install on an HPC Job Queue<a class="headerlink" href="#install-on-an-hpc-job-queue" title="Permalink to this headline">¶</a></h1>
<p>Here we provide instructions for installing and configuring
<code class="docutils literal notranslate"><span class="pre">dask-gateway-server</span></code> on a HPC Job Queue system like <a class="reference external" href="ttps://www.openpbs.org/">PBS</a> or <a class="reference external" href="https://slurm.schedmd.com/">Slurm</a>. Note
that <code class="docutils literal notranslate"><span class="pre">dask-gateway-server</span></code> only needs to be installed on one node (typically
an edge node).</p>
<p>Currently only <a class="reference external" href="ttps://www.openpbs.org/">PBS</a> and <a class="reference external" href="https://slurm.schedmd.com/">Slurm</a> are supported, but support for additional
backends is planned. If this is something you’re interested in, please <a class="reference external" href="https://github.com/dask/dask-gateway/issues">file an
issue</a>.</p>
<div class="section" id="create-a-user-account">
<h2>Create a user account<a class="headerlink" href="#create-a-user-account" title="Permalink to this headline">¶</a></h2>
<p>Before installing anything, you’ll need to create the user account which will
be used to run the <code class="docutils literal notranslate"><span class="pre">dask-gateway-server</span></code> process. The name of the user
doesn’t matter, only the permissions they have. Here we’ll use <code class="docutils literal notranslate"><span class="pre">dask</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>adduser<span class="w"> </span>dask
</pre></div>
</div>
</div>
<div class="section" id="create-install-directories">
<h2>Create install directories<a class="headerlink" href="#create-install-directories" title="Permalink to this headline">¶</a></h2>
<p>A <code class="docutils literal notranslate"><span class="pre">dask-gateway-server</span></code> installation has three types of files which will need
their own directories created before installation:</p>
<ul class="simple">
<li><p>Software files: This includes a Python environment and all required
libraries. Here we use <code class="docutils literal notranslate"><span class="pre">/opt/dask-gateway</span></code>.</p></li>
<li><p>Configuration files: Here we use <code class="docutils literal notranslate"><span class="pre">/etc/dask-gateway</span></code>.</p></li>
<li><p>Runtime files: Here we use <code class="docutils literal notranslate"><span class="pre">/var/dask-gateway</span></code>.</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Software files</span>
$<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/opt/dask-gateway

<span class="c1"># Configuration files</span>
$<span class="w"> </span>mkdir<span class="w"> </span>/etc/dask-gateway

<span class="c1"># Runtime files</span>
$<span class="w"> </span>mkdir<span class="w"> </span>/var/dask-gateway
$<span class="w"> </span>chown<span class="w"> </span>dask<span class="w"> </span>/var/dask-gateway
</pre></div>
</div>
</div>
<div class="section" id="install-a-python-environment">
<h2>Install a python environment<a class="headerlink" href="#install-a-python-environment" title="Permalink to this headline">¶</a></h2>
<p>To avoid interactions between the system python installation and
<code class="docutils literal notranslate"><span class="pre">dask-gateway-server</span></code>, we’ll install a full Python environment into the
software directory. The easiest way to do this is to use <a class="reference external" href="https://docs.conda.io/en/latest/miniconda.html">miniconda</a>, but this
isn’t a strict requirement.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>curl<span class="w"> </span>https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh<span class="w"> </span>-o<span class="w"> </span>/tmp/miniconda.sh
$<span class="w"> </span>bash<span class="w"> </span>/tmp/miniconda.sh<span class="w"> </span>-b<span class="w"> </span>-p<span class="w"> </span>/opt/dask-gateway/miniconda
$<span class="w"> </span>rm<span class="w"> </span>/tmp/miniconda.sh
</pre></div>
</div>
<p>We also recommend adding miniconda to the <code class="docutils literal notranslate"><span class="pre">root</span></code> user’s path to ease further
commands.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;export PATH=&quot;/opt/dask-gateway/miniconda/bin:$PATH&quot;&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/root/.bashrc
$<span class="w"> </span><span class="nb">source</span><span class="w"> </span>/root/.bashrc
</pre></div>
</div>
</div>
<div class="section" id="install-dask-gateway-server">
<h2>Install dask-gateway-server<a class="headerlink" href="#install-dask-gateway-server" title="Permalink to this headline">¶</a></h2>
<p>Now we can install <code class="docutils literal notranslate"><span class="pre">dask-gateway-server</span></code> and its dependencies.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conda<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>-c<span class="w"> </span>conda-forge<span class="w"> </span>dask-gateway-server-jobqueue
</pre></div>
</div>
</div>
<div class="section" id="enable-permissions-for-the-dask-user">
<h2>Enable permissions for the <code class="docutils literal notranslate"><span class="pre">dask</span></code> user<a class="headerlink" href="#enable-permissions-for-the-dask-user" title="Permalink to this headline">¶</a></h2>
<p>For <code class="docutils literal notranslate"><span class="pre">dask-gateway-server</span></code> to work properly, you’ll need to enable <a class="reference external" href="https://en.wikipedia.org/wiki/Sudo">sudo</a>
permissions for the <code class="docutils literal notranslate"><span class="pre">dask</span></code> user account. At a minimum, the <code class="docutils literal notranslate"><span class="pre">dask</span></code> account
will need passwordless permissions to run the
<code class="docutils literal notranslate"><span class="pre">dask-gateway-jobqueue-launcher</span></code> command (installed as part of
<code class="docutils literal notranslate"><span class="pre">dask-gateway-server</span></code> above) as any dask-gateway user.  The
<code class="docutils literal notranslate"><span class="pre">dask-gateway-jobqueue-launcher</span></code> script is responsible for launching,
tracking, and stopping batch jobs for individual users, and thus needs to be
sudo-executed as them for permissions to be transferred appropriately.</p>
<p>An example entry in <code class="docutils literal notranslate"><span class="pre">sudoers</span></code> might look like:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Cmnd_Alias DASK_GATEWAY_JOBQUEUE_LAUNCHER = /opt/dask-gateway/miniconda/bin/dask-gateway-jobqueue-launcher

dask ALL=(%dask_users,!root) NOPASSWD:DASK_GATEWAY_JOBQUEUE_LAUNCHER
</pre></div>
</div>
<p>Additionaly, when using <a class="reference external" href="ttps://www.openpbs.org/">PBS</a> you’ll need to make the <code class="docutils literal notranslate"><span class="pre">dask</span></code> user a PBS
Operator:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>qmgr<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;set server operators += dask@pbs&quot;</span>
</pre></div>
</div>
<p>Operator level permissions are needed in <a class="reference external" href="ttps://www.openpbs.org/">PBS</a> to allow <code class="docutils literal notranslate"><span class="pre">dask-gateway-server</span></code>
to more efficiently track the status of all users’ jobs.</p>
</div>
<div class="section" id="configure-dask-gateway-server">
<h2>Configure dask-gateway-server<a class="headerlink" href="#configure-dask-gateway-server" title="Permalink to this headline">¶</a></h2>
<p>Now we’re ready to configure our <code class="docutils literal notranslate"><span class="pre">dask-gateway-server</span></code> installation.
Configuration is written as a Python file (typically
<code class="docutils literal notranslate"><span class="pre">/etc/dask-gateway/dask_gateway_config.py</span></code>). Options are assigned to a config
object <code class="docutils literal notranslate"><span class="pre">c</span></code>, which is then loaded by the gateway on startup. You are free to
use any python syntax/libraries in this file that you want, the only things
that matter to <code class="docutils literal notranslate"><span class="pre">dask-gateway-server</span></code> are the values set on the <code class="docutils literal notranslate"><span class="pre">c</span></code> config
object.</p>
<p>Here we’ll walk through a few common configuration options you may want to set.</p>
<div class="section" id="specify-backend">
<h3>Specify backend<a class="headerlink" href="#specify-backend" title="Permalink to this headline">¶</a></h3>
<p>First you’ll need to specify which backend to use by setting
<code class="xref py py-data docutils literal notranslate"><span class="pre">c.DaskGateway.backend_class</span></code>. You have a few options:</p>
<ul class="simple">
<li><p>PBS: <code class="docutils literal notranslate"><span class="pre">dask_gateway_server.backends.jobqueue.pbs.PBSBackend</span></code></p></li>
<li><p>Slurm: <code class="docutils literal notranslate"><span class="pre">dask_gateway_server.backends.jobqueue.slurm.SlurmBackend</span></code></p></li>
</ul>
<p>For example, here we configure the gateway to use the PBS backend:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Configure the gateway to use PBS</span>
<span class="n">c</span><span class="o">.</span><span class="n">DaskGateway</span><span class="o">.</span><span class="n">backend_class</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;dask_gateway_server.backends.jobqueue.pbs.PBSBackend&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="configure-the-server-addresses-optional">
<h3>Configure the server addresses (optional)<a class="headerlink" href="#configure-the-server-addresses-optional" title="Permalink to this headline">¶</a></h3>
<p>By default, <code class="docutils literal notranslate"><span class="pre">dask-gateway-server</span></code> will serve all traffic through
<code class="docutils literal notranslate"><span class="pre">0.0.0.0:8000</span></code>. This includes both HTTP(S) requests (REST api, dashboards,
etc…) and dask scheduler traffic.</p>
<p>If you’d like to serve at a different address, or serve web and scheduler
traffic on different ports, you can configure the following fields:</p>
<ul class="simple">
<li><p><code class="xref py py-data docutils literal notranslate"><span class="pre">c.Proxy.address</span></code> - Serves HTTP(S) traffic, defaults to <code class="docutils literal notranslate"><span class="pre">:8000</span></code>.</p></li>
<li><p><code class="xref py py-data docutils literal notranslate"><span class="pre">c.Proxy.tcp_address</span></code> - Serves dask client-to-scheduler tcp traffic,
defaults to <code class="xref py py-data docutils literal notranslate"><span class="pre">c.Proxy.address</span></code>.</p></li>
</ul>
<p>Here we configure web traffic to serve on port 8000 and scheduler traffic to
serve on port 8001:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="o">.</span><span class="n">Proxy</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="s1">&#39;:8000&#39;</span>
<span class="n">c</span><span class="o">.</span><span class="n">Proxy</span><span class="o">.</span><span class="n">tcp_address</span> <span class="o">=</span> <span class="s1">&#39;:8001&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="specify-user-python-environments">
<h3>Specify user python environments<a class="headerlink" href="#specify-user-python-environments" title="Permalink to this headline">¶</a></h3>
<p>Since the Dask workers/schedulers will be running on disparate nodes across the
cluster, you’ll need to provide a way for Python environments to be available
on every node. You have a few options here:</p>
<ul class="simple">
<li><p>Use a fixed path to a Python environment available on every node</p></li>
<li><p>Allow users to specify the location of the Python environment (recommended)</p></li>
</ul>
<p>In either case, the Python environment requires at least the <code class="docutils literal notranslate"><span class="pre">dask-gateway</span></code>
package be installed to work properly.</p>
<div class="section" id="using-a-fixed-environment-path">
<h4>Using a fixed environment path<a class="headerlink" href="#using-a-fixed-environment-path" title="Permalink to this headline">¶</a></h4>
<p>If identical Python environments are available on every node (either local
disk, or NFS mount), you only need to configure <code class="docutils literal notranslate"><span class="pre">dask-gateway-server</span></code> to use
the provided Python. This could be done a few different ways:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Configure the paths to the dask-scheduler/dask-worker CLIs</span>
<span class="n">c</span><span class="o">.</span><span class="n">JobQueueClusterConfig</span><span class="o">.</span><span class="n">scheduler_cmd</span> <span class="o">=</span> <span class="s2">&quot;/path/to/dask-scheduler&quot;</span>
<span class="n">c</span><span class="o">.</span><span class="n">JobQueueClusterConfig</span><span class="o">.</span><span class="n">worker_cmd</span> <span class="o">=</span> <span class="s2">&quot;/path/to/dask-worker&quot;</span>

<span class="c1"># OR</span>
<span class="c1"># Activate a local conda environment before startup</span>
<span class="n">c</span><span class="o">.</span><span class="n">JobQueueClusterConfig</span><span class="o">.</span><span class="n">scheduler_setup</span> <span class="o">=</span> <span class="s1">&#39;source /path/to/miniconda/bin/activate /path/to/environment&#39;</span>
<span class="n">c</span><span class="o">.</span><span class="n">JobQueueClusterConfig</span><span class="o">.</span><span class="n">worker_setup</span> <span class="o">=</span> <span class="s1">&#39;source /path/to/miniconda/bin/activate /path/to/environment&#39;</span>

<span class="c1"># OR</span>
<span class="c1"># Activate a virtual environment before startup</span>
<span class="n">c</span><span class="o">.</span><span class="n">JobQueueClusterConfig</span><span class="o">.</span><span class="n">scheduler_setup</span> <span class="o">=</span> <span class="s1">&#39;source /path/to/your/environment/bin/activate&#39;</span>
<span class="n">c</span><span class="o">.</span><span class="n">JobQueueClusterConfig</span><span class="o">.</span><span class="n">worker_setup</span> <span class="o">=</span> <span class="s1">&#39;source /path/to/your/environment/bin/activate&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="user-configurable-python-environments">
<h4>User-configurable python environments<a class="headerlink" href="#user-configurable-python-environments" title="Permalink to this headline">¶</a></h4>
<p>Alternatively, you might want to allow users to provide their own Python
environments. This can be useful, as it allows users to manage package versions
themselves without needing to contact an admin for support.</p>
<p>This can be done by exposing an option for Python environment in
<code class="xref py py-data docutils literal notranslate"><span class="pre">c.Backend.cluster_options</span></code>. Exposing cluster options is
discussed in detail in <a class="reference internal" href="cluster-options.html"><span class="doc">Exposing Cluster Options</span></a> - here we’ll only provide a short
example of one way of accomplishing this. Please see <a class="reference internal" href="cluster-options.html"><span class="doc">Exposing Cluster Options</span></a> for
more information.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dask_gateway_server.options</span> <span class="kn">import</span> <span class="n">Options</span><span class="p">,</span> <span class="n">String</span>

<span class="k">def</span> <span class="nf">options_handler</span><span class="p">(</span><span class="n">options</span><span class="p">):</span>
    <span class="c1"># Fill in environment activation command template with the users</span>
    <span class="c1"># provided environment name. This command is then used as the setup</span>
    <span class="c1"># script for both the scheduler and workers.</span>
    <span class="n">setup</span> <span class="o">=</span> <span class="s2">&quot;source ~/miniconda/bin/activate </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">options</span><span class="o">.</span><span class="n">environment</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;scheduler_setup&quot;</span><span class="p">:</span> <span class="n">setup</span><span class="p">,</span> <span class="s2">&quot;worker_setup&quot;</span><span class="p">:</span> <span class="n">setup</span><span class="p">}</span>

<span class="c1"># Provide an option for users to specify the name or location of a</span>
<span class="c1"># conda environment to use for both the scheduler and workers.</span>
<span class="c1"># If not specified, the default environment of ``base`` is used.</span>
<span class="n">c</span><span class="o">.</span><span class="n">Backend</span><span class="o">.</span><span class="n">cluster_options</span> <span class="o">=</span> <span class="n">Options</span><span class="p">(</span>
    <span class="n">String</span><span class="p">(</span><span class="s2">&quot;environment&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;base&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Conda Environment&quot;</span><span class="p">),</span>
    <span class="n">handler</span><span class="o">=</span><span class="n">options_handler</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="additional-configuration-options">
<h3>Additional configuration options<a class="headerlink" href="#additional-configuration-options" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">dask-gateway-server</span></code> has several additional configuration fields. See the
<a class="reference internal" href="api-server.html"><span class="doc">Configuration Reference</span></a> docs (specifically <a class="reference internal" href="api-server.html#jobqueue-config"><span class="std std-ref">the jobqueue configuration docs</span></a>) for more information on all available options. At a minimum
you’ll probably want to configure the worker resource limits.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># The resource limits for a worker</span>
<span class="n">c</span><span class="o">.</span><span class="n">JobQueueClusterConfig</span><span class="o">.</span><span class="n">worker_memory</span> <span class="o">=</span> <span class="s1">&#39;4 G&#39;</span>
<span class="n">c</span><span class="o">.</span><span class="n">JobQueueClusterConfig</span><span class="o">.</span><span class="n">worker_cores</span> <span class="o">=</span> <span class="mi">2</span>
</pre></div>
</div>
<p>If your cluster is under high load (and jobs may be slow to start), you may
also want to increase the cluster/worker timeout values:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Increase startup timeouts to 5 min (600 seconds) each</span>
<span class="n">c</span><span class="o">.</span><span class="n">JobQueueClusterBackend</span><span class="o">.</span><span class="n">cluster_start_timeout</span> <span class="o">=</span> <span class="mi">600</span>
<span class="n">c</span><span class="o">.</span><span class="n">JobQueueClusterBackend</span><span class="o">.</span><span class="n">worker_start_timeout</span> <span class="o">=</span> <span class="mi">600</span>
</pre></div>
</div>
</div>
<div class="section" id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<p>In summary, an example <code class="docutils literal notranslate"><span class="pre">dask_gateway_config.py</span></code> configuration for PBS might
look like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Configure the gateway to use PBS as the backend</span>
<span class="n">c</span><span class="o">.</span><span class="n">DaskGateway</span><span class="o">.</span><span class="n">backend_class</span> <span class="o">=</span> <span class="s2">&quot;dask_gateway_server.backends.pbs.PBSBackend&quot;</span>

<span class="c1"># Configure the paths to the dask-scheduler/dask-worker CLIs</span>
<span class="n">c</span><span class="o">.</span><span class="n">PBSClusterConfig</span><span class="o">.</span><span class="n">scheduler_cmd</span> <span class="o">=</span> <span class="s2">&quot;~/miniconda/bin/dask-scheduler&quot;</span>
<span class="n">c</span><span class="o">.</span><span class="n">PBSClusterConfig</span><span class="o">.</span><span class="n">worker_cmd</span> <span class="o">=</span> <span class="s2">&quot;~/miniconda/bin/dask-worker&quot;</span>

<span class="c1"># Limit resources for a single worker</span>
<span class="n">c</span><span class="o">.</span><span class="n">PBSClusterConfig</span><span class="o">.</span><span class="n">worker_memory</span> <span class="o">=</span> <span class="s1">&#39;4 G&#39;</span>
<span class="n">c</span><span class="o">.</span><span class="n">PBSClusterConfig</span><span class="o">.</span><span class="n">worker_cores</span> <span class="o">=</span> <span class="mi">2</span>

<span class="c1"># Specify the PBS queue to use</span>
<span class="n">c</span><span class="o">.</span><span class="n">PBSClusterConfig</span><span class="o">.</span><span class="n">queue</span> <span class="o">=</span> <span class="s1">&#39;dask&#39;</span>

<span class="c1"># Increase startup timeouts to 5 min (600 seconds) each</span>
<span class="n">c</span><span class="o">.</span><span class="n">PBSClusterBackend</span><span class="o">.</span><span class="n">cluster_start_timeout</span> <span class="o">=</span> <span class="mi">600</span>
<span class="n">c</span><span class="o">.</span><span class="n">PBSClusterBackend</span><span class="o">.</span><span class="n">worker_start_timeout</span> <span class="o">=</span> <span class="mi">600</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="open-relevant-ports">
<h2>Open relevant ports<a class="headerlink" href="#open-relevant-ports" title="Permalink to this headline">¶</a></h2>
<p>For users to access the gateway server, they’ll need access to the public
port(s) set in <a class="reference internal" href="#configure-the-server-addresses-optional">Configure the server addresses (optional)</a> above (by default
this is port <code class="docutils literal notranslate"><span class="pre">8000</span></code>). How to expose ports is system specific - cluster
administrators should determine how best to perform this task.</p>
</div>
<div class="section" id="start-dask-gateway-server">
<h2>Start dask-gateway-server<a class="headerlink" href="#start-dask-gateway-server" title="Permalink to this headline">¶</a></h2>
<p>At this point you should be able to start the gateway server as the <code class="docutils literal notranslate"><span class="pre">dask</span></code>
user using your created configuration file. The <code class="docutils literal notranslate"><span class="pre">dask-gateway-server</span></code> process
will be a long running process - how you intend to manage it (<code class="docutils literal notranslate"><span class="pre">supervisord</span></code>,
etc…) is system specific. The requirements are:</p>
<ul class="simple">
<li><p>Start with <code class="docutils literal notranslate"><span class="pre">dask</span></code> as the user</p></li>
<li><p>Start with <code class="docutils literal notranslate"><span class="pre">/var/dask-gateway</span></code> as the working directory</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">/opt/dask-gateway/miniconda/bin</span></code> to path</p></li>
<li><p>Specify the configuration file location with <code class="docutils literal notranslate"><span class="pre">-f</span> <span class="pre">/etc/dask-gateway/dask_gateway_config.py</span></code></p></li>
</ul>
<p>For ease, we recommend creating a small bash script stored at
<code class="docutils literal notranslate"><span class="pre">/opt/dask-gateway/start-dask-gateway</span></code> to set this up:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env bash</span>

<span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;/opt/dask-gateway/miniconda/bin:</span><span class="nv">$PATH</span><span class="s2">&quot;</span>
<span class="nb">cd</span><span class="w"> </span>/var/dask-gateway
dask-gateway-server<span class="w"> </span>-f<span class="w"> </span>/etc/dask-gateway/dask_gateway_config.py
</pre></div>
</div>
<p>For <em>testing</em> here’s how you might start <code class="docutils literal notranslate"><span class="pre">dask-gateway-server</span></code> manually:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>/var/dask-gateway
$<span class="w"> </span>sudo<span class="w"> </span>-iu<span class="w"> </span>dask<span class="w"> </span>/opt/dask-gateway/start-dask-gateway
</pre></div>
</div>
</div>
<div class="section" id="validate-things-are-working">
<h2>Validate things are working<a class="headerlink" href="#validate-things-are-working" title="Permalink to this headline">¶</a></h2>
<p>If the server started with no errors, you’ll want to check that things are
working properly. The easiest way to do this is to try connecting as a user.</p>
<p>A user’s environment requires the <code class="docutils literal notranslate"><span class="pre">dask-gateway</span></code> library be installed.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install the dask-gateway client library</span>
$<span class="w"> </span>conda<span class="w"> </span>create<span class="w"> </span>-n<span class="w"> </span>dask-gateway<span class="w"> </span>-c<span class="w"> </span>conda-forge<span class="w"> </span>dask-gateway
</pre></div>
</div>
<p>You can connect to the gateway by creating a <a class="reference internal" href="api-client.html#dask_gateway.Gateway" title="dask_gateway.Gateway"><code class="xref py py-class docutils literal notranslate"><span class="pre">dask_gateway.Gateway</span></code></a>
object, specifying the public address (note that if you configured
<code class="xref py py-data docutils literal notranslate"><span class="pre">c.Proxy.tcp_address</span></code> you’ll also need to specify the <code class="docutils literal notranslate"><span class="pre">proxy_address</span></code>).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">dask_gateway</span> <span class="kn">import</span> <span class="n">Gateway</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gateway</span> <span class="o">=</span> <span class="n">Gateway</span><span class="p">(</span><span class="s2">&quot;http://public-address&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>You should now be able to make API calls. Try
<a class="reference internal" href="api-client.html#dask_gateway.Gateway.list_clusters" title="dask_gateway.Gateway.list_clusters"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dask_gateway.Gateway.list_clusters()</span></code></a>, this should return an empty list.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">gateway</span><span class="o">.</span><span class="n">list_clusters</span><span class="p">()</span>
<span class="go">[]</span>
</pre></div>
</div>
<p>Next, see if you can create a cluster. This may take a few minutes.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cluster</span> <span class="o">=</span> <span class="n">gateway</span><span class="o">.</span><span class="n">new_cluster</span><span class="p">()</span>
</pre></div>
</div>
<p>The last thing you’ll want to check is if you can successfully connect to your
newly created cluster.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">client</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">get_client</span><span class="p">()</span>
</pre></div>
</div>
<p>If everything worked properly, you can shutdown your cluster with
<a class="reference internal" href="api-client.html#dask_gateway.GatewayCluster.shutdown" title="dask_gateway.GatewayCluster.shutdown"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dask_gateway.GatewayCluster.shutdown()</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cluster</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>


              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="install-kube.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Install on a Kubernetes Cluster</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="authentication.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Authentication</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Jim Crist-Harif<br/>
    
        &copy; Copyright 2021, Jim Crist-Harif.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

<!-- Google Tag Manager -->
<script>
  (function (w, d, s, l, i) {
    w[l] = w[l] || [];
    w[l].push({
      "gtm.start": new Date().getTime(),
      event: "gtm.js",
    });
    var f = d.getElementsByTagName(s)[0],
      j = d.createElement(s),
      dl = l != "dataLayer" ? "&l=" + l : "";
    j.async = true;
    j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
    f.parentNode.insertBefore(j, f);
  })(
    window,
    document,
    "script",
    "dataLayer",
    "GTM-P4GQM59"
  );
</script>
<!-- End Google Tag Manager -->

  </body>
</html>